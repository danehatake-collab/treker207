<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a0c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HUSTLE YEAR">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="12-–Ω–µ–¥–µ–ª—å–Ω—ã–π —Å–ø—Ä–∏–Ω—Ç –∫ —Ü–µ–ª—è–º">
    
    <!-- PWA Manifest (inline base64) -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiSFVTVExFIFlFQVIiLCJzaG9ydF9uYW1lIjoiSFVTVExFIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwYTBhMGMiLCJ0aGVtZV9jb2xvciI6IiMwYTBhMGMiLCJvcmllbnRhdGlvbiI6ImFueSIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDUxMiA1MTInJTNFJTNDcmVjdCB3aWR0aD0nNTEyJyBoZWlnaHQ9JzUxMicgcng9JzEwMCcgZmlsbD0nJTIzMGEwYTBjJy8lM0UlM0N0ZXh0IHg9JzUwJTI1JyB5PSc1MCUyNScgZG9taW5hbnQtYmFzZWxpbmU9J2NlbnRyYWwnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZvbnQtc2l6ZT0nMjgwJyUzRfCfjK8lM0MvdGV4dCUzRSUzQy9zdmclM0UiLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCIsInB1cnBvc2UiOiJhbnkgbWFza2FibGUifV19">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' rx='40' fill='%230a0a0c'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='central' text-anchor='middle' font-size='100'%3EüéØ%3C/text%3E%3C/svg%3E">
    
    <title>HUSTLE YEAR</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root {
            --bg-primary: #0a0a0c; --bg-secondary: #111114; --bg-elevated: #18181c;
            --bg-card: rgba(24, 24, 28, 0.8); --bg-glass: rgba(255, 255, 255, 0.02);
            --border-subtle: rgba(255, 255, 255, 0.04); --border-default: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff; --text-secondary: #9ca3af; --text-muted: #6b7280;
            --accent: #f97316; --accent-light: #fb923c; --accent-dim: rgba(249, 115, 22, 0.12);
            --accent-glow: rgba(249, 115, 22, 0.4);
            --amber: #fbbf24; --amber-dim: rgba(251, 191, 36, 0.12);
            --emerald: #10b981; --emerald-dim: rgba(16, 185, 129, 0.12);
            --rose: #f43f5e; --rose-dim: rgba(244, 63, 94, 0.12);
            --violet: #8b5cf6; --violet-dim: rgba(139, 92, 246, 0.12);
            --cyan: #06b6d4;
            --gradient-fire: linear-gradient(135deg, rgba(249, 115, 22, 0.25) 0%, rgba(239, 68, 68, 0.08) 100%);
            --gradient-ocean: linear-gradient(135deg, rgba(6, 182, 212, 0.25) 0%, rgba(59, 130, 246, 0.08) 100%);
            --gradient-forest: linear-gradient(135deg, rgba(16, 185, 129, 0.25) 0%, rgba(34, 197, 94, 0.08) 100%);
            --radius-md: 16px; --radius-lg: 20px; --radius-xl: 24px; --radius-full: 9999px;
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1); --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
            --safe-bottom: env(safe-area-inset-bottom, 0px); --sidebar-width: 280px;
        }
        html, body { height: 100%; font-family: 'Outfit', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); overflow: hidden; line-height: 1.5; -webkit-font-smoothing: antialiased; }
        
        /* App Layout */
        .app { height: 100%; display: flex; flex-direction: column; max-width: 480px; margin: 0 auto; position: relative; background: var(--bg-primary); }
        
        /* Desktop Layout */
        @media (min-width: 768px) {
            .app { max-width: 100%; flex-direction: row; margin: 0; }
            .desktop-sidebar { width: var(--sidebar-width); min-width: var(--sidebar-width); height: 100vh; background: var(--bg-secondary); border-right: 1px solid var(--border-subtle); display: flex; flex-direction: column; padding: 24px 16px; position: fixed; left: 0; top: 0; z-index: 100; }
            .desktop-main { flex: 1; margin-left: var(--sidebar-width); height: 100vh; display: flex; flex-direction: column; }
            .mobile-only { display: none !important; }
            .bottom-nav { display: none !important; }
            .fab { right: 40px; bottom: 40px; }
        }
        @media (max-width: 767px) { .desktop-only { display: none !important; } .desktop-sidebar { display: none !important; } .desktop-main { margin-left: 0 !important; } }
        @media (min-width: 1200px) { :root { --sidebar-width: 320px; } }
        
        /* Sidebar */
        .sidebar-logo { font-size: 28px; font-weight: 800; background: linear-gradient(135deg, var(--accent) 0%, var(--amber) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 8px; padding: 0 8px; }
        .sidebar-subtitle { font-size: 12px; color: var(--text-muted); padding: 0 8px; margin-bottom: 32px; }
        .sidebar-nav { display: flex; flex-direction: column; gap: 4px; flex: 1; }
        .sidebar-nav-item { display: flex; align-items: center; gap: 12px; padding: 14px 16px; border-radius: var(--radius-lg); background: none; border: none; color: var(--text-secondary); font-family: inherit; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s var(--ease-out); text-align: left; }
        .sidebar-nav-item:hover { background: var(--bg-glass); color: var(--text-primary); }
        .sidebar-nav-item.active { background: var(--accent-dim); color: var(--accent); }
        .sidebar-nav-item svg { width: 20px; height: 20px; flex-shrink: 0; }
        .sidebar-sprint-info { margin-top: auto; padding: 16px; background: var(--bg-elevated); border-radius: var(--radius-lg); border: 1px solid var(--border-subtle); }
        .sidebar-sprint-name { font-size: 13px; font-weight: 600; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .sidebar-sprint-dates { font-size: 11px; color: var(--text-muted); margin-bottom: 8px; }
        .sidebar-sprint-progress { height: 4px; background: var(--bg-primary); border-radius: 2px; overflow: hidden; }
        .sidebar-sprint-progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--amber)); border-radius: 2px; transition: width 0.5s var(--ease-out); }
        
        /* Offline Banner */
        .offline-banner { position: fixed; top: 0; left: 0; right: 0; padding: 12px 20px; background: linear-gradient(135deg, var(--amber) 0%, var(--accent) 100%); color: var(--bg-primary); font-size: 13px; font-weight: 600; text-align: center; z-index: 1000; transform: translateY(-100%); transition: transform 0.3s var(--ease-out); display: flex; align-items: center; justify-content: center; gap: 8px; }
        .offline-banner.show { transform: translateY(0); }
        @media (min-width: 768px) { .offline-banner { left: var(--sidebar-width); } }
        
        /* Sync Indicator */
        .sync-indicator { position: fixed; top: 16px; right: 16px; padding: 10px 16px; background: var(--emerald); color: white; border-radius: var(--radius-full); font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 8px; z-index: 999; opacity: 0; transform: translateY(-20px); transition: all 0.3s var(--ease-spring); }
        .sync-indicator.show { opacity: 1; transform: translateY(0); }
        .sync-indicator svg { width: 14px; height: 14px; animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        /* Ambient */
        .parallax-bg { position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 0; }
        @media (min-width: 768px) { .parallax-bg { left: var(--sidebar-width); } }
        .ambient-glow { position: absolute; top: -150px; left: 50%; transform: translateX(-50%); width: 600px; height: 600px; background: radial-gradient(circle, rgba(251, 191, 36, 0.3) 0%, rgba(249, 115, 22, 0.2) 30%, transparent 70%); opacity: 0.8; filter: blur(80px); animation: ambientFloat 10s ease-in-out infinite; }
        .ambient-glow-2 { position: absolute; top: 30%; right: -100px; width: 400px; height: 400px; background: radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%); filter: blur(60px); animation: ambientFloat2 12s ease-in-out infinite; }
        @keyframes ambientFloat { 0%, 100% { transform: translateX(-50%) translateY(0) scale(1); opacity: 0.6; } 50% { transform: translateX(-50%) translateY(-20px) scale(1.05); opacity: 0.8; } }
        @keyframes ambientFloat2 { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-30px) scale(1.1); } }
        
        /* Header */
        .header { padding: 16px 20px; background: transparent; display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 10; animation: slideDown 0.6s var(--ease-out); }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .logo { font-size: 24px; font-weight: 800; background: linear-gradient(135deg, var(--accent) 0%, var(--amber) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .week-badge { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-full); font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.3s var(--ease-spring); }
        .week-badge:hover { background: var(--bg-glass); border-color: var(--border-default); }
        .week-num { color: var(--accent); font-weight: 700; }
        
        /* Main */
        .main { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 0 20px 140px; -webkit-overflow-scrolling: touch; position: relative; z-index: 1; scroll-behavior: smooth; overscroll-behavior: contain; touch-action: pan-y; }
        @media (min-width: 768px) { .main { padding: 32px 40px 60px; } }
        .page-container { animation: pageSlideIn 0.5s var(--ease-out); }
        @keyframes pageSlideIn { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }
        .stagger-item { opacity: 0; transform: translateY(30px); animation: staggerIn 0.6s var(--ease-out) forwards; }
        @keyframes staggerIn { to { opacity: 1; transform: translateY(0); } }
        /* Progress Ring */
        .hero-progress { position: relative; padding: 20px 0; text-align: center; }
        .progress-ring-container { position: relative; width: 170px; height: 170px; margin: 0 auto 16px; animation: ringFloat 4s ease-in-out infinite; }
        @media (min-width: 768px) { .progress-ring-container { width: 200px; height: 200px; } .progress-ring { width: 200px; height: 200px; } .progress-ring-value { font-size: 64px; } }
        @keyframes ringFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        .progress-ring-glow { position: absolute; inset: -40px; border-radius: 50%; background: radial-gradient(circle, var(--accent-glow) 0%, rgba(249, 115, 22, 0.1) 50%, transparent 70%); opacity: 0.7; filter: blur(30px); animation: pulseGlow 3s ease-in-out infinite; }
        @keyframes pulseGlow { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 0.9; transform: scale(1.15); } }
        .progress-ring { transform: rotate(-90deg); width: 170px; height: 170px; position: relative; z-index: 1; }
        .progress-ring-bg { fill: none; stroke: var(--bg-elevated); stroke-width: 12; }
        .progress-ring-fill { fill: none; stroke: url(#progressGradient); stroke-width: 12; stroke-linecap: round; stroke-dasharray: 471; stroke-dashoffset: 471; transition: stroke-dashoffset 1.5s var(--ease-out); filter: drop-shadow(0 0 20px var(--accent-glow)); }
        .progress-ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 2; }
        .progress-ring-value { font-size: 56px; font-weight: 800; letter-spacing: -2px; line-height: 1; }
        .progress-ring-label { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; margin-top: 4px; }
        
        /* Bento Stats */
        .bento-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 24px; }
        @media (min-width: 768px) { .bento-grid { grid-template-columns: repeat(4, 1fr); gap: 16px; } }
        .bento-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl); padding: 20px; position: relative; overflow: hidden; backdrop-filter: blur(10px); transition: all 0.4s var(--ease-spring); cursor: pointer; }
        .bento-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 80px; background: var(--card-gradient, var(--gradient-fire)); opacity: 0.6; filter: blur(30px); transition: opacity 0.3s, transform 0.3s; }
        .bento-card:hover { transform: translateY(-4px) scale(1.02); border-color: var(--border-default); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .bento-card:hover::before { opacity: 0.9; transform: scale(1.1); }
        .bento-icon { font-size: 28px; margin-bottom: 12px; position: relative; z-index: 1; transition: transform 0.3s var(--ease-spring); }
        .bento-card:hover .bento-icon { transform: scale(1.2) rotate(-5deg); }
        .bento-value { font-size: 36px; font-weight: 800; letter-spacing: -1px; line-height: 1; margin-bottom: 4px; color: var(--value-color, var(--accent)); position: relative; z-index: 1; }
        .bento-label { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; position: relative; z-index: 1; }
        
        /* Weekly Chart */
        .weekly-chart-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl); padding: 20px; margin-bottom: 24px; position: relative; overflow: hidden; backdrop-filter: blur(10px); transition: all 0.3s var(--ease-out); }
        .weekly-chart-card:hover { border-color: var(--border-default); }
        .weekly-chart-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .weekly-chart-title { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
        .weekly-chart-value { font-size: 40px; font-weight: 800; letter-spacing: -1px; }
        .weekly-chart-change { display: inline-flex; align-items: center; gap: 4px; padding: 6px 12px; background: var(--emerald-dim); border-radius: var(--radius-full); font-size: 12px; font-weight: 600; color: var(--emerald); }
        .bar-chart { display: flex; justify-content: space-around; align-items: flex-end; height: 120px; gap: 8px; padding: 10px 0; }
        @media (min-width: 768px) { .bar-chart { height: 160px; gap: 12px; } }
        .bar-column { flex: 1; max-width: 60px; display: flex; flex-direction: column; align-items: center; gap: 8px; animation: barSlideUp 0.5s var(--ease-out) backwards; }
        @keyframes barSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .bar-value { font-size: 12px; font-weight: 700; color: var(--text-secondary); min-height: 18px; }
        .bar-track { width: 100%; height: 80px; background: var(--bg-elevated); border-radius: 8px; display: flex; align-items: flex-end; overflow: hidden; position: relative; }
        @media (min-width: 768px) { .bar-track { height: 120px; } }
        .bar-fill { width: 100%; background: linear-gradient(180deg, var(--accent) 0%, var(--amber) 100%); border-radius: 8px; transition: height 1s var(--ease-out); position: relative; min-height: 4px; }
        .bar-fill.current { background: linear-gradient(180deg, var(--accent-light) 0%, var(--accent) 100%); box-shadow: 0 0 20px var(--accent-glow); animation: barPulse 2s ease-in-out infinite; }
        @keyframes barPulse { 0%, 100% { box-shadow: 0 0 15px var(--accent-glow); } 50% { box-shadow: 0 0 25px var(--accent-glow); } }
        .bar-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 50%; background: linear-gradient(180deg, rgba(255,255,255,0.2) 0%, transparent 100%); border-radius: 8px 8px 0 0; }
        .bar-label { font-size: 11px; font-weight: 600; color: var(--text-muted); }
        .bar-column:last-child .bar-label { color: var(--accent); }
        
        /* Section */
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; margin-top: 8px; }
        .section-title { font-size: 12px; font-weight: 700; color: var(--text-muted); letter-spacing: 1.5px; text-transform: uppercase; }
        
        /* Goals */
        .goals-list { display: flex; flex-direction: column; gap: 14px; }
        @media (min-width: 768px) { .goals-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 20px; } }
        .goal-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl); padding: 20px; cursor: pointer; position: relative; overflow: hidden; backdrop-filter: blur(10px); transition: all 0.4s var(--ease-spring); }
        .goal-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 120px; background: var(--card-gradient, var(--gradient-fire)); opacity: 0.5; filter: blur(40px); transition: all 0.4s var(--ease-out); }
        .goal-card:hover { border-color: var(--border-default); transform: translateY(-4px) scale(1.01); box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        .goal-card:hover::before { opacity: 0.8; transform: scale(1.1); }
        .goal-card.gradient-fire { --card-gradient: var(--gradient-fire); }
        .goal-card.gradient-ocean { --card-gradient: var(--gradient-ocean); }
        .goal-card.gradient-forest { --card-gradient: var(--gradient-forest); }
        .goal-header { display: flex; align-items: flex-start; gap: 14px; margin-bottom: 16px; position: relative; z-index: 1; }
        .goal-icon { font-size: 40px; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3)); transition: transform 0.4s var(--ease-spring); }
        .goal-card:hover .goal-icon { transform: scale(1.15) rotate(-8deg); }
        .goal-info { flex: 1; }
        .goal-title { font-size: 18px; font-weight: 700; margin-bottom: 4px; line-height: 1.3; }
        .goal-subtitle { font-size: 13px; color: var(--text-muted); }
        .mini-ring-container { width: 58px; height: 58px; position: relative; flex-shrink: 0; transition: transform 0.3s var(--ease-spring); }
        .goal-card:hover .mini-ring-container { transform: scale(1.1); }
        .mini-ring { transform: rotate(-90deg); width: 58px; height: 58px; }
        .mini-ring-bg { fill: none; stroke: var(--bg-primary); stroke-width: 5; }
        .mini-ring-fill { fill: none; stroke: var(--accent); stroke-width: 5; stroke-linecap: round; stroke-dasharray: 157; stroke-dashoffset: 157; transition: stroke-dashoffset 1s var(--ease-out); }
        .mini-ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 14px; font-weight: 700; color: var(--accent); }
        .goal-tasks { display: flex; gap: 8px; flex-wrap: wrap; position: relative; z-index: 1; }
        .task-tag { padding: 8px 14px; background: var(--bg-primary); border-radius: var(--radius-full); font-size: 12px; font-weight: 500; color: var(--text-secondary); transition: all 0.2s var(--ease-spring); }
        .task-tag:hover { background: var(--accent-dim); color: var(--accent); transform: scale(1.05); }
        /* Empty State */
        .empty-state { text-align: center; padding: 60px 30px; }
        .empty-icon { width: 110px; height: 110px; margin: 0 auto 24px; background: var(--accent-dim); border-radius: var(--radius-xl); display: flex; align-items: center; justify-content: center; font-size: 52px; animation: emptyFloat 3s ease-in-out infinite; position: relative; }
        .empty-icon::after { content: ''; position: absolute; inset: -20px; border-radius: var(--radius-xl); background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%); opacity: 0.5; filter: blur(25px); z-index: -1; }
        @keyframes emptyFloat { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-15px) rotate(3deg); } }
        .empty-title { font-size: 26px; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 8px; }
        .empty-text { font-size: 14px; color: var(--text-muted); max-width: 280px; margin: 0 auto; }
        
        /* Sprint Info */
        .sprint-info { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 18px; margin-bottom: 20px; backdrop-filter: blur(10px); transition: all 0.3s var(--ease-out); }
        .sprint-info:hover { border-color: var(--border-default); }
        .sprint-dates { display: flex; justify-content: space-between; align-items: center; }
        .sprint-date { text-align: center; }
        .sprint-date-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px; }
        .sprint-date-value { font-size: 18px; font-weight: 700; color: var(--accent); }
        .sprint-arrow { color: var(--text-muted); animation: arrowPulse 2s ease-in-out infinite; }
        @keyframes arrowPulse { 0%, 100% { transform: translateX(0); opacity: 0.5; } 50% { transform: translateX(5px); opacity: 1; } }
        .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: var(--radius-full); font-size: 11px; font-weight: 600; }
        .status-badge.active { background: var(--emerald-dim); color: var(--emerald); }
        .status-badge.expired { background: var(--amber-dim); color: var(--amber); }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; animation: statusPulse 2s ease-in-out infinite; }
        @keyframes statusPulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
        
        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px; padding: 12px 16px calc(12px + var(--safe-bottom)); background: linear-gradient(to top, var(--bg-primary) 70%, transparent); z-index: 100; animation: navSlideUp 0.6s var(--ease-out); }
        @keyframes navSlideUp { from { transform: translateX(-50%) translateY(100%); } to { transform: translateX(-50%) translateY(0); } }
        .nav-container { display: flex; justify-content: space-around; background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl); padding: 6px; backdrop-filter: blur(20px); }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 10px 14px; border-radius: var(--radius-lg); background: none; border: none; color: var(--text-muted); font-size: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s var(--ease-spring); position: relative; }
        .nav-item::before { content: ''; position: absolute; inset: 0; background: var(--accent-dim); border-radius: var(--radius-lg); opacity: 0; transform: scale(0.8); transition: all 0.3s var(--ease-spring); }
        .nav-item.active { color: var(--accent); }
        .nav-item.active::before { opacity: 1; transform: scale(1); }
        .nav-item svg { width: 22px; height: 22px; position: relative; z-index: 1; transition: transform 0.3s var(--ease-spring); }
        .nav-item.active svg { transform: scale(1.1); }
        .nav-item span { position: relative; z-index: 1; }
        
        /* FAB */
        .fab { position: fixed; right: 20px; bottom: calc(100px + var(--safe-bottom)); width: 62px; height: 62px; border-radius: var(--radius-full); background: linear-gradient(135deg, var(--accent) 0%, var(--amber) 100%); border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 32px var(--accent-glow), 0 4px 12px rgba(0,0,0,0.3); z-index: 101; transition: all 0.3s var(--ease-spring); animation: fabBounceIn 0.6s var(--ease-spring) 0.3s backwards; }
        @keyframes fabBounceIn { 0% { transform: scale(0) rotate(-180deg); opacity: 0; } 60% { transform: scale(1.2) rotate(10deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        .fab:hover { transform: scale(1.1) rotate(90deg); box-shadow: 0 12px 40px var(--accent-glow); }
        .fab svg { width: 26px; height: 26px; }
        
        /* Modals */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); display: flex; align-items: flex-end; justify-content: center; z-index: 200; opacity: 0; visibility: hidden; transition: all 0.4s var(--ease-out); }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal { width: 100%; max-width: 480px; max-height: 90vh; background: var(--bg-secondary); border-radius: var(--radius-xl) var(--radius-xl) 0 0; transform: translateY(100%); transition: transform 0.5s var(--ease-spring); display: flex; flex-direction: column; border: 1px solid var(--border-subtle); border-bottom: none; }
        .modal-overlay.show .modal { transform: translateY(0); }
        @media (min-width: 768px) { .modal { border-radius: var(--radius-xl); border-bottom: 1px solid var(--border-subtle); max-height: 85vh; } .modal-overlay { align-items: center; } }
        .modal-handle { width: 40px; height: 5px; background: var(--border-default); border-radius: var(--radius-full); margin: 12px auto 8px; cursor: grab; }
        @media (min-width: 768px) { .modal-handle { display: none; } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 20px 16px; border-bottom: 1px solid var(--border-subtle); }
        .modal-title { font-size: 20px; font-weight: 700; }
        .modal-close { width: 40px; height: 40px; border-radius: var(--radius-full); background: var(--bg-elevated); border: none; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s var(--ease-spring); }
        .modal-close:hover { background: var(--rose-dim); color: var(--rose); transform: rotate(90deg); }
        .modal-body { padding: 20px; overflow-y: auto; flex: 1; }
        .modal-footer { padding: 16px 20px calc(16px + var(--safe-bottom)); border-top: 1px solid var(--border-subtle); display: flex; gap: 12px; }
        @media (min-width: 768px) { .modal-footer { padding: 16px 20px; } }
        
        /* Forms */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
        .form-input { width: 100%; padding: 16px 18px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: inherit; font-size: 15px; transition: all 0.3s var(--ease-out); }
        .form-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 4px var(--accent-dim); transform: translateY(-2px); }
        .form-input::placeholder { color: var(--text-muted); }
        select.form-input { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 16px center; padding-right: 48px; cursor: pointer; }
        textarea.form-input { resize: none; min-height: 90px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .icon-picker { display: flex; flex-wrap: wrap; gap: 8px; padding: 12px; background: var(--bg-elevated); border-radius: var(--radius-md); }
        .icon-option { width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; font-size: 26px; border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s var(--ease-spring); background: transparent; border: 2px solid transparent; }
        .icon-option:hover { transform: scale(1.15) rotate(-5deg); background: var(--bg-glass); }
        .icon-option.selected { background: var(--accent-dim); border-color: var(--accent); transform: scale(1.1); }
        
        /* Buttons */
        .btn { flex: 1; padding: 16px 24px; border-radius: var(--radius-md); font-family: inherit; font-size: 14px; font-weight: 600; cursor: pointer; border: none; transition: all 0.3s var(--ease-spring); position: relative; overflow: hidden; }
        .btn:active { transform: scale(0.97); }
        .btn-primary { background: linear-gradient(135deg, var(--accent) 0%, var(--amber) 100%); color: white; box-shadow: 0 4px 16px var(--accent-glow); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px var(--accent-glow); }
        .btn-secondary { background: var(--bg-elevated); color: var(--text-secondary); }
        .btn-secondary:hover { background: var(--bg-glass); }
        .btn-danger { background: var(--rose-dim); color: var(--rose); }
        .btn-violet { background: linear-gradient(135deg, var(--violet) 0%, #c084fc 100%); color: white; }
        
        /* Task Rows */
        .task-row { display: flex; gap: 8px; margin-bottom: 12px; align-items: center; animation: taskSlideIn 0.4s var(--ease-out) backwards; }
        @keyframes taskSlideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .task-row .form-input { flex: 1; }
        .task-row select { width: 110px; flex-shrink: 0; }
        .icon-btn { width: 44px; height: 44px; border-radius: var(--radius-md); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s var(--ease-spring); }
        .icon-btn.danger { background: var(--rose-dim); color: var(--rose); }
        .icon-btn.danger:hover { background: var(--rose); color: white; }
        .add-task-btn { width: 100%; padding: 16px; background: var(--bg-glass); border: 2px dashed var(--border-default); border-radius: var(--radius-md); color: var(--text-secondary); font-family: inherit; font-size: 13px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s var(--ease-spring); }
        .add-task-btn:hover { background: var(--accent-dim); border-color: var(--accent); color: var(--accent); transform: scale(1.02); }
        /* Detail View */
        .detail-header { padding: 20px; background: linear-gradient(180deg, var(--bg-secondary) 0%, transparent 100%); position: relative; }
        .detail-header::before { content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 300px; height: 200px; background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%); opacity: 0.4; filter: blur(50px); }
        .back-btn { display: inline-flex; align-items: center; gap: 6px; background: none; border: none; color: var(--accent); font-family: inherit; font-size: 14px; font-weight: 500; cursor: pointer; padding: 8px 0; margin-bottom: 16px; position: relative; z-index: 1; transition: all 0.2s var(--ease-out); }
        .back-btn:hover { transform: translateX(-4px); }
        .detail-title { font-size: 28px; font-weight: 800; margin-bottom: 20px; position: relative; z-index: 1; }
        .detail-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; position: relative; z-index: 1; }
        .detail-stat { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; text-align: center; backdrop-filter: blur(10px); transition: all 0.3s var(--ease-out); }
        .detail-stat:hover { transform: translateY(-2px); border-color: var(--border-default); }
        .detail-stat-value { font-size: 28px; font-weight: 800; letter-spacing: -1px; line-height: 1; margin-bottom: 4px; }
        .detail-stat-label { font-size: 10px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; }
        .detail-actions { display: flex; gap: 10px; margin-top: 16px; position: relative; z-index: 1; }
        .action-btn { flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-secondary); font-family: inherit; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.3s var(--ease-spring); }
        .action-btn:hover { background: var(--bg-glass); transform: translateY(-2px); }
        .action-btn.danger { color: var(--rose); background: var(--rose-dim); border-color: transparent; }
        .action-btn.danger:hover { background: var(--rose); color: white; }
        
        /* Task Section */
        .task-section { padding: 20px; }
        .task-item { display: flex; align-items: center; gap: 14px; padding: 18px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); margin-bottom: 10px; cursor: pointer; transition: all 0.3s var(--ease-spring); backdrop-filter: blur(10px); position: relative; overflow: hidden; }
        .task-item:hover { transform: translateX(4px); border-color: var(--border-default); }
        .task-item.completed { background: var(--emerald-dim); border-color: rgba(16, 185, 129, 0.2); }
        .task-checkbox { width: 32px; height: 32px; border-radius: var(--radius-full); border: 2px solid var(--border-default); background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.3s var(--ease-spring); }
        .task-checkbox:hover { border-color: var(--accent); transform: scale(1.1); }
        .task-checkbox.checked { background: var(--emerald); border-color: var(--emerald); animation: checkBounce 0.5s var(--ease-spring); }
        @keyframes checkBounce { 0% { transform: scale(1); } 30% { transform: scale(1.4); } 100% { transform: scale(1); } }
        .task-checkbox svg { width: 14px; height: 14px; color: white; opacity: 0; transform: scale(0); transition: all 0.3s var(--ease-spring); }
        .task-checkbox.checked svg { opacity: 1; transform: scale(1); }
        .task-info { flex: 1; min-width: 0; }
        .task-name { font-size: 15px; font-weight: 500; margin-bottom: 2px; transition: all 0.3s; }
        .task-item.completed .task-name { color: var(--text-muted); text-decoration: line-through; }
        .task-freq { font-size: 12px; color: var(--text-muted); }
        .task-streak { display: flex; align-items: center; gap: 4px; padding: 8px 14px; background: var(--amber-dim); border-radius: var(--radius-full); font-size: 13px; font-weight: 600; color: var(--amber); transition: all 0.3s var(--ease-spring); }
        
        /* Celebration */
        .celebration-overlay { position: fixed; inset: 0; background: rgba(10, 10, 12, 0.97); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 500; opacity: 0; visibility: hidden; transition: all 0.5s var(--ease-out); }
        .celebration-overlay.show { opacity: 1; visibility: visible; }
        .celebration-emoji { font-size: 100px; margin-bottom: 24px; animation: celebrateBounce 0.6s var(--ease-spring) infinite; }
        @keyframes celebrateBounce { 0%, 100% { transform: scale(1) rotate(0deg); } 50% { transform: scale(1.2) rotate(10deg); } }
        .celebration-title { font-size: 36px; font-weight: 800; color: var(--emerald); margin-bottom: 12px; text-align: center; }
        .celebration-subtitle { font-size: 16px; color: var(--text-secondary); margin-bottom: 40px; text-align: center; max-width: 300px; }
        .celebration-close { padding: 18px 56px; background: linear-gradient(135deg, var(--accent) 0%, var(--amber) 100%); border: none; border-radius: var(--radius-full); color: white; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 32px var(--accent-glow); transition: all 0.3s var(--ease-spring); }
        .celebration-close:hover { transform: scale(1.05); }
        
        /* Analytics */
        .analytics-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl); padding: 20px; margin-bottom: 16px; backdrop-filter: blur(10px); transition: all 0.3s var(--ease-out); }
        .analytics-card:hover { border-color: var(--border-default); }
        .analytics-title { font-size: 15px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
        .analytics-title span { font-size: 20px; }
        .tracker-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(28px, 1fr)); gap: 6px; }
        .tracker-cell { aspect-ratio: 1; border-radius: 8px; background: var(--bg-elevated); display: flex; align-items: center; justify-content: center; transition: all 0.2s var(--ease-spring); cursor: pointer; }
        .tracker-cell:hover { transform: scale(1.15); }
        .tracker-cell.done { background: var(--emerald); box-shadow: 0 0 16px rgba(16, 185, 129, 0.4); }
        .tracker-cell svg { width: 12px; height: 12px; color: white; opacity: 0; }
        .tracker-cell.done svg { opacity: 1; }
        .heatmap { display: grid; grid-template-columns: repeat(12, 1fr); gap: 4px; }
        .heatmap-cell { aspect-ratio: 1; border-radius: 4px; background: var(--bg-elevated); cursor: pointer; transition: all 0.2s var(--ease-spring); }
        .heatmap-cell:hover { transform: scale(1.2); }
        .heatmap-cell.done { background: var(--emerald); }
        .heatmap-cell.missed { background: var(--rose-dim); }
        .heatmap-legend { display: flex; justify-content: flex-end; align-items: center; gap: 8px; margin-top: 14px; font-size: 10px; color: var(--text-muted); }
        .heatmap-legend-item { width: 12px; height: 12px; border-radius: 3px; }
        
        /* Settings */
        .settings-item { display: flex; justify-content: space-between; align-items: center; padding: 18px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); margin-bottom: 10px; cursor: pointer; transition: all 0.3s var(--ease-spring); backdrop-filter: blur(10px); }
        .settings-item:hover { transform: translateX(4px); border-color: var(--border-default); }
        .settings-icon { width: 44px; height: 44px; border-radius: var(--radius-md); background: var(--accent-dim); display: flex; align-items: center; justify-content: center; margin-right: 14px; color: var(--accent); transition: all 0.3s var(--ease-spring); }
        .settings-item:hover .settings-icon { transform: scale(1.1) rotate(-5deg); }
        .settings-icon.violet { background: var(--violet-dim); color: var(--violet); }
        .toggle-switch { width: 52px; height: 30px; background: var(--bg-elevated); border-radius: var(--radius-full); position: relative; cursor: pointer; transition: all 0.3s var(--ease-spring); flex-shrink: 0; }
        .toggle-switch.active { background: var(--accent); }
        .toggle-knob { width: 24px; height: 24px; background: white; border-radius: 50%; position: absolute; top: 3px; left: 3px; transition: all 0.3s var(--ease-spring); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .toggle-switch.active .toggle-knob { left: 25px; }
        .settings-content { flex: 1; }
        .settings-label { font-size: 15px; font-weight: 500; margin-bottom: 2px; }
        .settings-desc { font-size: 12px; color: var(--text-muted); }
        .sprint-selector { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 18px; margin-bottom: 20px; backdrop-filter: blur(10px); }
        .sprint-selector-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
        .sprint-selector-title { font-size: 12px; font-weight: 700; letter-spacing: 1px; color: var(--text-muted); text-transform: uppercase; }
        .sprint-list { display: flex; flex-direction: column; gap: 8px; max-height: 200px; overflow-y: auto; }
        .sprint-item { display: flex; justify-content: space-between; align-items: center; padding: 14px; background: var(--bg-elevated); border-radius: var(--radius-md); cursor: pointer; transition: all 0.3s var(--ease-spring); }
        .sprint-item:hover { background: var(--bg-glass); transform: translateX(4px); }
        .sprint-item.active { background: var(--accent-dim); border: 1px solid var(--accent); }
        .sprint-item-name { font-size: 14px; font-weight: 500; }
        .sprint-item-dates { font-size: 11px; color: var(--text-muted); }
        
        /* Review & Archive */
        .review-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 18px; margin-bottom: 12px; backdrop-filter: blur(10px); transition: all 0.3s var(--ease-out); }
        .review-card:hover { border-color: var(--border-default); transform: translateY(-2px); }
        .review-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
        .review-week { font-size: 15px; font-weight: 700; }
        .review-score { padding: 6px 14px; background: var(--accent-dim); border-radius: var(--radius-full); font-size: 14px; font-weight: 700; color: var(--accent); }
        .review-section { margin-bottom: 12px; }
        .review-question { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px; }
        .review-answer { font-size: 13px; color: var(--text-secondary); line-height: 1.5; }
        .archive-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl); padding: 20px; margin-bottom: 16px; cursor: pointer; transition: all 0.4s var(--ease-spring); position: relative; overflow: hidden; backdrop-filter: blur(10px); }
        .archive-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 80px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.25) 0%, rgba(236, 72, 153, 0.08) 100%); opacity: 0.5; filter: blur(30px); }
        .archive-card:hover { border-color: var(--violet); transform: translateY(-4px) scale(1.01); }
        .archive-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; position: relative; z-index: 1; }
        .archive-name { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
        .archive-dates { font-size: 12px; color: var(--text-muted); }
        .archive-score { padding: 10px 18px; background: var(--violet-dim); border-radius: var(--radius-full); font-size: 18px; font-weight: 700; color: var(--violet); }
        .archive-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; position: relative; z-index: 1; }
        .archive-stat { text-align: center; padding: 12px; background: var(--bg-elevated); border-radius: var(--radius-md); }
        .archive-stat-value { font-size: 20px; font-weight: 700; color: var(--text-primary); }
        .archive-stat-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; }
        .sprint-complete-banner { background: linear-gradient(135deg, var(--violet-dim) 0%, var(--accent-dim) 100%); border: 1px solid var(--violet); border-radius: var(--radius-xl); padding: 28px; margin-bottom: 24px; text-align: center; position: relative; overflow: hidden; }
        .sprint-complete-icon { font-size: 52px; margin-bottom: 14px; position: relative; z-index: 1; animation: iconWiggle 1s ease-in-out infinite; }
        @keyframes iconWiggle { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }
        .sprint-complete-title { font-size: 22px; font-weight: 800; color: var(--violet); margin-bottom: 8px; position: relative; z-index: 1; }
        .sprint-complete-text { font-size: 14px; color: var(--text-secondary); margin-bottom: 18px; position: relative; z-index: 1; }
        .sprint-complete-actions { display: flex; gap: 12px; justify-content: center; position: relative; z-index: 1; }
        
        /* Toast & Effects */
        .toast { position: fixed; bottom: calc(140px + var(--safe-bottom)); left: 50%; transform: translateX(-50%) translateY(20px); padding: 16px 28px; background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: var(--radius-full); font-size: 14px; font-weight: 500; box-shadow: 0 12px 40px rgba(0,0,0,0.5); z-index: 300; opacity: 0; visibility: hidden; transition: all 0.4s var(--ease-spring); backdrop-filter: blur(10px); }
        .toast.show { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
        .toast.success { background: var(--emerald); border-color: var(--emerald); color: white; }
        @media (min-width: 768px) { .toast { bottom: 40px; } }
        .success-ring { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--emerald); animation: ringPulse 0.6s var(--ease-out) forwards; z-index: 1000; pointer-events: none; }
        @keyframes ringPulse { 0% { transform: translate(-50%, -50%) scale(0); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; } }
        .confetti-container { position: fixed; inset: 0; pointer-events: none; z-index: 1000; overflow: hidden; }
        .confetti { position: absolute; width: 10px; height: 10px; animation: confettiFall 1.5s var(--ease-out) forwards; }
        @keyframes confettiFall { 0% { transform: translateY(-20px) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .pull-indicator { position: fixed; top: 0; left: 50%; transform: translateX(-50%) translateY(-100%); padding: 12px 24px; background: var(--bg-elevated); border-radius: 0 0 var(--radius-lg) var(--radius-lg); font-size: 12px; font-weight: 600; color: var(--text-muted); transition: transform 0.3s var(--ease-out); z-index: 50; }
        .pull-indicator.show { transform: translateX(-50%) translateY(0); }
        @media (min-width: 768px) { .pull-indicator { display: none; } }
        
        /* Utilities */
        .hidden { display: none !important; }
        .text-accent { color: var(--accent); }
        .text-emerald { color: var(--emerald); }
        .text-rose { color: var(--rose); }
        .text-amber { color: var(--amber); }
        .text-violet { color: var(--violet); }
        .skeleton { background: linear-gradient(90deg, var(--bg-elevated) 25%, var(--bg-card) 50%, var(--bg-elevated) 75%); background-size: 200% 100%; animation: skeletonWave 1.5s ease-in-out infinite; border-radius: var(--radius-md); }
        @keyframes skeletonWave { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .skeleton-card { height: 180px; margin-bottom: 14px; border-radius: var(--radius-xl); }
        .skeleton-stat { height: 100px; border-radius: var(--radius-lg); }
        .skeleton-ring { width: 170px; height: 170px; border-radius: 50%; margin: 0 auto 20px; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border-default); border-radius: 4px; }
    </style>
</head>
<body>
    <div class="offline-banner" id="offlineBanner">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 1l22 22M16.72 11.06A10.94 10.94 0 0119 12.55M5 12.55a10.94 10.94 0 015.17-2.39"/></svg>
        <span>–û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º ‚Äî –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã</span>
    </div>
    <div class="sync-indicator" id="syncIndicator">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 11-6.219-8.56"/></svg>
        <span>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</span>
    </div>

    <div class="app" id="app">
        <aside class="desktop-sidebar desktop-only" id="desktopSidebar">
            <div class="sidebar-logo">HUSTLE YEAR</div>
            <div class="sidebar-subtitle">12-–Ω–µ–¥–µ–ª—å–Ω—ã–π —Å–ø—Ä–∏–Ω—Ç</div>
            <nav class="sidebar-nav">
                <button class="sidebar-nav-item active" data-tab="home" onclick="switchTab('home')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>–û–±–∑–æ—Ä</span></button>
                <button class="sidebar-nav-item" data-tab="analytics" onclick="switchTab('analytics')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><span>–¢—Ä–µ–∫–µ—Ä</span></button>
                <button class="sidebar-nav-item" data-tab="archive" onclick="switchTab('archive')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 8v13H3V8"/><path d="M1 3h22v5H1z"/><path d="M10 12h4"/></svg><span>–ê—Ä—Ö–∏–≤</span></button>
                <button class="sidebar-nav-item" data-tab="review" onclick="switchTab('review')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg><span>–ò—Ç–æ–≥–∏</span></button>
                <button class="sidebar-nav-item" data-tab="settings" onclick="switchTab('settings')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg><span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></button>
            </nav>
            <div class="sidebar-sprint-info" id="sidebarSprintInfo"></div>
        </aside>
        
        <div class="desktop-main">
            <div class="parallax-bg" id="parallaxBg"><div class="ambient-glow"></div><div class="ambient-glow-2"></div></div>
            <div class="pull-indicator mobile-only" id="pullIndicator">‚Üì –ü–æ—Ç—è–Ω–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</div>
            <header class="header mobile-only">
                <div class="logo">HUSTLE YEAR</div>
                <div class="week-badge" onclick="switchTab('settings')"><span>–ù–µ–¥–µ–ª—è</span><span class="week-num" id="weekNum">1/12</span></div>
            </header>
            <main class="main" id="mainContent"></main>
        </div>
        
        <button class="fab" id="fab" onclick="openCreateModal()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
        
        <nav class="bottom-nav mobile-only" id="bottomNav">
            <div class="nav-container">
                <button class="nav-item active" data-tab="home" onclick="switchTab('home')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>–û–±–∑–æ—Ä</span></button>
                <button class="nav-item" data-tab="analytics" onclick="switchTab('analytics')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><span>–¢—Ä–µ–∫–µ—Ä</span></button>
                <button class="nav-item" data-tab="archive" onclick="switchTab('archive')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 8v13H3V8"/><path d="M1 3h22v5H1z"/><path d="M10 12h4"/></svg><span>–ê—Ä—Ö–∏–≤</span></button>
                <button class="nav-item" data-tab="review" onclick="switchTab('review')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg><span>–ò—Ç–æ–≥–∏</span></button>
                <button class="nav-item" data-tab="settings" onclick="switchTab('settings')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg><span>–ï—â—ë</span></button>
            </div>
        </nav>
        
        <!-- Create Modal -->
        <div class="modal-overlay" id="createModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header"><span class="modal-title" id="modalTitle">–ù–æ–≤–∞—è —Ü–µ–ª—å</span><button class="modal-close" onclick="closeCreateModal()"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
                <div class="modal-body">
                    <div class="form-group"><label class="form-label">–ò–∫–æ–Ω–∫–∞</label><div class="icon-picker" id="iconPicker"></div></div>
                    <div class="form-group"><label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏</label><input type="text" class="form-input" id="goalTitle" placeholder="–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å"></div>
                    <div class="form-group"><label class="form-label">–î–µ–π—Å—Ç–≤–∏—è</label><div id="tasksList"></div><button class="add-task-btn" onclick="addTaskField()"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>–î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ</button></div>
                </div>
                <div class="modal-footer"><button class="btn btn-secondary" onclick="closeCreateModal()">–û—Ç–º–µ–Ω–∞</button><button class="btn btn-primary" onclick="saveGoal()">–°–æ–∑–¥–∞—Ç—å</button></div>
            </div>
        </div>
        
        <!-- Sprint Modal -->
        <div class="modal-overlay" id="newSprintModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header"><span class="modal-title">üöÄ –ù–æ–≤—ã–π —Å–ø—Ä–∏–Ω—Ç</span><button class="modal-close" onclick="closeNewSprintModal()"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
                <div class="modal-body">
                    <div class="form-group"><label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø—Ä–∏–Ω—Ç–∞</label><input type="text" class="form-input" id="newSprintName" placeholder="Q1 2025 Sprint"></div>
                    <div class="form-row"><div class="form-group"><label class="form-label">–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞</label><input type="date" class="form-input" id="newSprintStart" onchange="updateNewSprintDays()"></div><div class="form-group"><label class="form-label">–î–∞—Ç–∞ —Ñ–∏–Ω–∏—à–∞</label><input type="date" class="form-input" id="newSprintEnd" onchange="updateNewSprintDays()"></div></div>
                    <div class="sprint-info" style="margin-top:8px"><div style="text-align:center"><div style="font-size:42px;font-weight:800;color:var(--accent)" id="newSprintDays">84</div><div style="font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px">–î–Ω–µ–π –≤ —Å–ø—Ä–∏–Ω—Ç–µ</div></div></div>
                </div>
                <div class="modal-footer"><button class="btn btn-secondary" onclick="closeNewSprintModal()">–û—Ç–º–µ–Ω–∞</button><button class="btn btn-primary" onclick="createNewSprintFromModal()">–°–æ–∑–¥–∞—Ç—å</button></div>
            </div>
        </div>
        
        <!-- Review Modal -->
        <div class="modal-overlay" id="reviewModal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-header"><span class="modal-title">–ò—Ç–æ–≥–∏ –Ω–µ–¥–µ–ª–∏ <span id="reviewWeekNum"></span></span><button class="modal-close" onclick="closeReviewModal()"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
                <div class="modal-body">
                    <div class="form-group"><label class="form-label">–û—Ü–µ–Ω–∫–∞ (%)</label><input type="number" class="form-input" id="reviewScore" min="0" max="100" value="50"></div>
                    <div class="form-group"><label class="form-label">‚ö° –ì–¥–µ —Å–ª–∏–ª —ç–Ω–µ—Ä–≥–∏—é?</label><textarea class="form-input" id="reviewEnergy" placeholder="–ß—Ç–æ –æ—Ç–≤–ª–µ–∫–∞–ª–æ..."></textarea></div>
                    <div class="form-group"><label class="form-label">üöß –ß—Ç–æ —Ç–æ—Ä–º–æ–∑–∏—Ç?</label><textarea class="form-input" id="reviewBlocker" placeholder="–ß—Ç–æ –º–µ—à–∞–µ—Ç..."></textarea></div>
                    <div class="form-group"><label class="form-label">üéØ –¢–æ—á–∫–∏ —Ä–æ—Å—Ç–∞</label><textarea class="form-input" id="reviewGrowth" placeholder="–ù–∞–¥ —á–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å..."></textarea></div>
                    <div class="form-group"><label class="form-label">üèÜ –ü–æ–±–µ–¥—ã</label><textarea class="form-input" id="reviewWins" placeholder="–ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å..."></textarea></div>
                </div>
                <div class="modal-footer"><button class="btn btn-secondary" onclick="closeReviewModal()">–û—Ç–º–µ–Ω–∞</button><button class="btn btn-primary" onclick="saveReview()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div>
            </div>
        </div>
        
        <!-- Celebrations -->
        <div class="celebration-overlay" id="celebrationOverlay"><div class="celebration-emoji">üéâ</div><div class="celebration-title">–í—Å—ë —Å–¥–µ–ª–∞–Ω–æ!</div><div class="celebration-subtitle">–¢—ã –≤—ã–ø–æ–ª–Ω–∏–ª –≤—Å–µ –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div><button class="celebration-close" onclick="closeCelebration()">–û—Ç–ª–∏—á–Ω–æ</button></div>
        <div class="celebration-overlay" id="sprintCompleteOverlay"><div class="celebration-emoji">üèÜ</div><div class="celebration-title">–°–ø—Ä–∏–Ω—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!</div><div class="celebration-subtitle" id="sprintCompleteStats">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</div><div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center"><button class="celebration-close" style="background:linear-gradient(135deg, var(--violet) 0%, #c084fc 100%)" onclick="archiveAndNewSprint()">–ù–æ–≤—ã–π —Å–ø—Ä–∏–Ω—Ç</button><button class="celebration-close" style="background:var(--bg-elevated);color:var(--text-secondary)" onclick="closeSprintComplete()">–ü–æ–∑–∂–µ</button></div></div>
        
        <div class="toast" id="toast"></div>
        <div class="confetti-container" id="confettiContainer"></div>
        
        <svg width="0" height="0" style="position:absolute"><defs><linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#f97316"/><stop offset="100%" style="stop-color:#fbbf24"/></linearGradient><linearGradient id="violetGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#8b5cf6"/><stop offset="100%" style="stop-color:#c084fc"/></linearGradient></defs></svg>
    </div>
    <script>
    // ==================== PWA SETUP ====================
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
            try {
                const reg = await navigator.serviceWorker.register('./sw.js');
                console.log('[App] SW registered');
                reg.addEventListener('updatefound', () => {
                    const nw = reg.installing;
                    nw.addEventListener('statechange', () => {
                        if (nw.state === 'installed' && navigator.serviceWorker.controller) showToast('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ! üîÑ');
                    });
                });
            } catch (e) { console.error('[App] SW error:', e); }
        });
        navigator.serviceWorker.addEventListener('message', (e) => {
            if (e.data.type === 'SYNC_COMPLETE') { showSyncIndicator(); showToast('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ! ‚ú®', 'success'); }
        });
    }
    
    let isOnline = navigator.onLine;
    function updateOnlineStatus() {
        const was = !isOnline; isOnline = navigator.onLine;
        document.getElementById('offlineBanner').classList.toggle('show', !isOnline);
        if (was && isOnline) triggerSync();
    }
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();
    
    async function triggerSync() {
        if ('serviceWorker' in navigator && 'sync' in window.SyncManager) {
            try { const r = await navigator.serviceWorker.ready; await r.sync.register('sync-data'); showSyncIndicator(); } catch (e) {}
        } else showSyncIndicator();
    }
    function showSyncIndicator() {
        const i = document.getElementById('syncIndicator'); i.classList.add('show'); setTimeout(() => i.classList.remove('show'), 2000);
    }
    
    // ==================== STATE ====================
    let state = { currentSprintId: null, sprints: [], archivedSprints: [], settings: { soundEnabled: true, vibrationEnabled: true } };
    let currentTab = 'home', selectedGoal = null, selectedTask = null, selectedArchive = null, editingGoalId = null, selectedIcon = 'üéØ', isLoading = true;
    
    const FREQ = { 'daily': { label: '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ', total: 84 }, 'weekly': { label: '1√ó/–Ω–µ–¥–µ–ª—é', total: 12 }, 'twice-week': { label: '2√ó/–Ω–µ–¥–µ–ª—é', total: 24 }, 'three-week': { label: '3√ó/–Ω–µ–¥–µ–ª—é', total: 36 }, 'workdays': { label: '–ü–æ –±—É–¥–Ω—è–º', total: 60 } };
    const ICONS = ['üéØ', 'üöÄ', 'üí™', 'üìà', '‚≠ê', 'üî•', 'üí°', 'üèÜ', 'üí∞', 'üìö', 'üé®', 'üèÉ', 'üßò', 'üíª', '‚úçÔ∏è', 'üé∏'];
    const GRADIENTS = ['gradient-fire', 'gradient-ocean', 'gradient-forest'];
    const ACCENT_COLORS = ['var(--accent)', 'var(--cyan)', 'var(--emerald)'];
    
    // Audio & Haptics
    let audioCtx = null;
    function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); return audioCtx; }
    const SoundFX = {
        taskComplete: () => { if (!state.settings?.soundEnabled) return; try { const c = initAudio(), o = c.createOscillator(), g = c.createGain(); o.connect(g); g.connect(c.destination); o.frequency.setValueAtTime(880, c.currentTime); o.frequency.exponentialRampToValueAtTime(1320, c.currentTime + 0.1); o.type = 'sine'; g.gain.setValueAtTime(0.3, c.currentTime); g.gain.exponentialRampToValueAtTime(0.01, c.currentTime + 0.2); o.start(c.currentTime); o.stop(c.currentTime + 0.2); } catch(e) {} },
        celebration: () => { if (!state.settings?.soundEnabled) return; try { const c = initAudio(); [523.25, 659.25, 783.99, 1046.50].forEach((f, i) => { const o = c.createOscillator(), g = c.createGain(); o.connect(g); g.connect(c.destination); o.frequency.setValueAtTime(f, c.currentTime + i * 0.1); o.type = 'sine'; g.gain.setValueAtTime(0.3, c.currentTime + i * 0.1); g.gain.exponentialRampToValueAtTime(0.01, c.currentTime + i * 0.1 + 0.3); o.start(c.currentTime + i * 0.1); o.stop(c.currentTime + i * 0.1 + 0.3); }); } catch(e) {} },
        tap: () => { if (!state.settings?.soundEnabled) return; try { const c = initAudio(), o = c.createOscillator(), g = c.createGain(); o.connect(g); g.connect(c.destination); o.frequency.setValueAtTime(600, c.currentTime); o.type = 'sine'; g.gain.setValueAtTime(0.1, c.currentTime); g.gain.exponentialRampToValueAtTime(0.01, c.currentTime + 0.05); o.start(c.currentTime); o.stop(c.currentTime + 0.05); } catch(e) {} }
    };
    function haptic(t = 'light') { if (!state.settings?.vibrationEnabled || !('vibrate' in navigator)) return; const v = { light: 10, medium: 25, heavy: 40, success: [10, 30, 10, 30, 20], celebration: [10, 20, 10, 20, 50] }; navigator.vibrate(v[t] || 10); }
    
    // Utils
    const genId = () => Math.random().toString(36).substr(2, 9);
    const getToday = () => new Date().toISOString().split('T')[0];
    const escapeHtml = t => { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; };
    function formatDate(ds) { return new Date(ds).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' }); }
    function formatDateFull(ds) { return new Date(ds).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' }); }
    
    function loadState() {
        try { const s = localStorage.getItem('hustleYear_v10_pwa'); if (s) state = JSON.parse(s); if (!state.archivedSprints) state.archivedSprints = []; if (!state.settings) state.settings = { soundEnabled: true, vibrationEnabled: true }; if (state.sprints.length > 0 && !state.currentSprintId) state.currentSprintId = state.sprints[0]?.id; checkExpiredSprints(); } catch(e) {}
        setTimeout(() => { isLoading = false; render(); }, 500);
    }
    function saveState() { try { state.lastSync = new Date().toISOString(); localStorage.setItem('hustleYear_v10_pwa', JSON.stringify(state)); } catch(e) {} }
    function getCurrentSprint() { return state.sprints.find(s => s.id === state.currentSprintId) || state.sprints[0]; }
    function checkExpiredSprints() { const today = getToday(); const exp = state.sprints.filter(s => s.endDate < today); if (exp.length > 0) setTimeout(() => { if (exp.some(s => s.id === state.currentSprintId)) showSprintCompleteOverlay(); }, 1500); }
    function isSprintExpired(s) { return s && s.endDate < getToday(); }
    
    function getSprintDays(sprint = getCurrentSprint()) { return sprint ? Math.ceil((new Date(sprint.endDate) - new Date(sprint.startDate)) / 86400000) : 84; }
    function getCurrentWeek() { const s = getCurrentSprint(); if (!s) return { current: 1, total: 12 }; const start = new Date(s.startDate), end = new Date(s.endDate), now = new Date(); const totalDays = Math.ceil((end - start) / 86400000), totalWeeks = Math.ceil(totalDays / 7), daysPassed = Math.floor((now - start) / 86400000); return { current: Math.min(Math.max(Math.ceil((daysPassed + 1) / 7), 1), totalWeeks), total: totalWeeks }; }
    function getProgress(goal) { const s = getCurrentSprint(); if (!goal.tasks?.length || !s) return 0; let total = 0, done = 0, days = getSprintDays(); goal.tasks.forEach(t => { const f = FREQ[t.frequency]; if (f) { total += Math.round(f.total * days / 84); Object.keys(s.completions).forEach(k => { if (k.startsWith(t.id + '_') && s.completions[k]) done++; }); } }); return total > 0 ? Math.min(Math.round(done / total * 100), 100) : 0; }
    function getTaskDone(tid) { const s = getCurrentSprint(); return s ? Object.keys(s.completions).filter(k => k.startsWith(tid + '_') && s.completions[k]).length : 0; }
    function getTaskTotal(freq) { const f = FREQ[freq]; return f ? Math.round(f.total * getSprintDays() / 84) : 0; }
    function getWeeklyScore(weekNum) { const s = getCurrentSprint(); if (!s?.goals?.length) return 0; const start = new Date(s.startDate), weekStart = new Date(start); weekStart.setDate(start.getDate() + (weekNum - 1) * 7); const weekEnd = new Date(weekStart); weekEnd.setDate(weekStart.getDate() + 6); let total = 0, done = 0; s.goals.forEach(g => g.tasks.forEach(t => { for (let d = new Date(weekStart); d <= weekEnd; d.setDate(d.getDate() + 1)) { const ds = d.toISOString().split('T')[0], dow = d.getDay(); let shouldDo = t.frequency === 'daily' || (t.frequency === 'workdays' && dow >= 1 && dow <= 5) || (t.frequency === 'weekly' && dow === 1) || (t.frequency === 'twice-week' && (dow === 1 || dow === 4)) || (t.frequency === 'three-week' && (dow === 1 || dow === 3 || dow === 5)); if (shouldDo) { total++; if (s.completions[t.id + '_' + ds]) done++; } } })); return total > 0 ? Math.round(done / total * 100) : 0; }
    function getTrendData() { const w = getCurrentWeek(), data = []; for (let i = 1; i <= w.current; i++) data.push(getWeeklyScore(i)); return data; }
    function calculateSprintScore(sprint) { if (!sprint?.goals?.length) return 0; let total = 0, done = 0, days = getSprintDays(sprint); sprint.goals.forEach(g => g.tasks.forEach(t => { const f = FREQ[t.frequency]; if (f) { total += Math.round(f.total * days / 84); Object.keys(sprint.completions || {}).forEach(k => { if (k.startsWith(t.id + '_') && sprint.completions[k]) done++; }); } })); return total > 0 ? Math.round(done / total * 100) : 0; }
    function countCompletedTasks(sprint) { return Object.values(sprint.completions || {}).filter(v => v).length; }
    function countTotalTasks(sprint) { if (!sprint?.goals) return 0; let t = 0, d = getSprintDays(sprint); sprint.goals.forEach(g => g.tasks.forEach(task => { const f = FREQ[task.frequency]; if (f) t += Math.round(f.total * d / 84); })); return t; }
    
    function createNewSprint(name, startDate, endDate) { const start = startDate || getToday(), end = endDate || new Date(Date.now() + 84*86400000).toISOString().split('T')[0]; const sprint = { id: genId(), name: name || `–°–ø—Ä–∏–Ω—Ç ${state.sprints.length + state.archivedSprints.length + 1}`, startDate: start, endDate: end, goals: [], completions: {}, reviews: [], createdAt: new Date().toISOString() }; state.sprints.push(sprint); state.currentSprintId = sprint.id; saveState(); return sprint; }
    function archiveSprint(sprintId) { const idx = state.sprints.findIndex(s => s.id === sprintId); if (idx === -1) return; const sprint = state.sprints[idx]; sprint.archivedAt = new Date().toISOString(); sprint.finalScore = calculateSprintScore(sprint); sprint.totalTasksCompleted = countCompletedTasks(sprint); sprint.totalTasks = countTotalTasks(sprint); state.archivedSprints.unshift(sprint); state.sprints.splice(idx, 1); if (state.currentSprintId === sprintId) state.currentSprintId = state.sprints[0]?.id || null; saveState(); showToast('–°–ø—Ä–∏–Ω—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω! üì¶', 'success'); }
    
    // Effects
    function showConfetti() { const c = document.getElementById('confettiContainer'), colors = ['#f97316', '#fbbf24', '#10b981', '#8b5cf6', '#06b6d4', '#f43f5e', '#fff']; for (let i = 0; i < 60; i++) { const e = document.createElement('div'); e.className = 'confetti'; e.style.left = Math.random() * 100 + '%'; e.style.background = colors[Math.floor(Math.random() * colors.length)]; e.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px'; e.style.width = (6 + Math.random() * 6) + 'px'; e.style.height = (6 + Math.random() * 6) + 'px'; e.style.animationDelay = Math.random() * 0.5 + 's'; c.appendChild(e); setTimeout(() => e.remove(), 2000); } }
    function showSuccessRing() { const r = document.createElement('div'); r.className = 'success-ring'; document.body.appendChild(r); setTimeout(() => r.remove(), 600); }
    function showCelebration() { haptic('celebration'); SoundFX.celebration(); showConfetti(); document.getElementById('celebrationOverlay').classList.add('show'); }
    function closeCelebration() { haptic('light'); document.getElementById('celebrationOverlay').classList.remove('show'); }
    function showSprintCompleteOverlay() { const s = getCurrentSprint(); if (!s) return; const score = calculateSprintScore(s), comp = countCompletedTasks(s), total = countTotalTasks(s); document.getElementById('sprintCompleteStats').innerHTML = `–í—ã–ø–æ–ª–Ω–µ–Ω–æ ${comp} –∏–∑ ${total} –∑–∞–¥–∞—á (${score}%)`; haptic('celebration'); SoundFX.celebration(); showConfetti(); document.getElementById('sprintCompleteOverlay').classList.add('show'); }
    function closeSprintComplete() { haptic('light'); document.getElementById('sprintCompleteOverlay').classList.remove('show'); }
    function archiveAndNewSprint() { const s = getCurrentSprint(); if (s) archiveSprint(s.id); closeSprintComplete(); openNewSprintModal(); }
    function showToast(msg, type = '') { const t = document.getElementById('toast'); t.textContent = msg; t.className = 'toast show ' + type; setTimeout(() => t.classList.remove('show'), 2500); }
    function checkDayCompletion() { const s = getCurrentSprint(); if (!s?.goals?.length) return; const today = getToday(), dow = new Date().getDay(); let total = 0, done = 0; s.goals.forEach(g => g.tasks.forEach(t => { let shouldDo = t.frequency === 'daily' || (t.frequency === 'workdays' && dow >= 1 && dow <= 5) || (t.frequency === 'weekly' && dow === 1) || (t.frequency === 'twice-week' && (dow === 1 || dow === 4)) || (t.frequency === 'three-week' && (dow === 1 || dow === 3 || dow === 5)); if (shouldDo) { total++; if (s.completions[t.id + '_' + today]) done++; } })); if (total > 0 && done === total) showCelebration(); }
    function animateCounter(el, target, duration = 1000) { const start = parseInt(el.textContent) || 0, startTime = performance.now(); function update(t) { const p = Math.min((t - startTime) / duration, 1); el.textContent = Math.round(start + (target - start) * (1 - Math.pow(1 - p, 4))); if (p < 1) requestAnimationFrame(update); } requestAnimationFrame(update); }
    // ==================== RENDER ====================
    function updateSidebarSprintInfo() { const c = document.getElementById('sidebarSprintInfo'); if (!c) return; const s = getCurrentSprint(); if (!s) { c.innerHTML = '<div style="text-align:center;padding:8px 0"><div style="font-size:13px;color:var(--text-muted);margin-bottom:8px">–ù–µ—Ç —Å–ø—Ä–∏–Ω—Ç–∞</div><button class="btn btn-primary" style="width:100%;padding:12px" onclick="openNewSprintModal()">–°–æ–∑–¥–∞—Ç—å</button></div>'; return; } const overall = s.goals.length > 0 ? Math.round(s.goals.reduce((a, g) => a + getProgress(g), 0) / s.goals.length) : 0; c.innerHTML = `<div class="sidebar-sprint-name">${escapeHtml(s.name)}</div><div class="sidebar-sprint-dates">${formatDate(s.startDate)} ‚Äî ${formatDate(s.endDate)}</div><div class="sidebar-sprint-progress"><div class="sidebar-sprint-progress-fill" style="width:${overall}%"></div></div><div style="display:flex;justify-content:space-between;margin-top:8px;font-size:11px"><span style="color:var(--text-muted)">–ü—Ä–æ–≥—Ä–µ—Å—Å</span><span style="color:var(--accent);font-weight:600">${overall}%</span></div>`; }
    
    function render() {
        const s = getCurrentSprint(), w = s ? getCurrentWeek() : { current: 0, total: 0 };
        const weekEl = document.getElementById('weekNum'); if (weekEl) weekEl.textContent = w.current + '/' + w.total;
        updateSidebarSprintInfo();
        const main = document.getElementById('mainContent'), fab = document.getElementById('fab'), nav = document.getElementById('bottomNav');
        if (isLoading) { main.innerHTML = '<div class="page-container"><div class="skeleton skeleton-ring"></div><div class="bento-grid"><div class="skeleton skeleton-stat"></div><div class="skeleton skeleton-stat"></div><div class="skeleton skeleton-stat"></div><div class="skeleton skeleton-stat"></div></div><div class="skeleton skeleton-card"></div></div>'; return; }
        let content = '';
        if (selectedArchive) { fab.classList.add('hidden'); if (nav) nav.classList.add('hidden'); content = renderArchiveDetail(); }
        else if (selectedGoal) { fab.classList.add('hidden'); if (nav) nav.classList.add('hidden'); content = renderGoalDetail(); }
        else if (selectedTask) { fab.classList.add('hidden'); if (nav) nav.classList.add('hidden'); content = renderTaskTracker(); }
        else { const showFab = currentTab === 'home' && s && !isSprintExpired(s) && (s?.goals?.length || 0) < 3; fab.classList.toggle('hidden', !showFab); if (nav) nav.classList.remove('hidden'); switch (currentTab) { case 'home': content = renderHome(); break; case 'analytics': content = renderAnalytics(); break; case 'archive': content = renderArchive(); break; case 'review': content = renderReview(); break; case 'settings': content = renderSettings(); break; } }
        main.innerHTML = content;
        document.querySelectorAll('.nav-item, .sidebar-nav-item').forEach(b => b.classList.toggle('active', b.dataset.tab === currentTab));
        requestAnimationFrame(() => { document.querySelectorAll('.stagger-item').forEach((e, i) => e.style.animationDelay = (i * 0.08) + 's'); document.querySelectorAll('.progress-ring-fill').forEach(r => { const p = parseFloat(r.dataset.percent) || 0; setTimeout(() => r.style.strokeDashoffset = 471 - (471 * p / 100), 100); }); document.querySelectorAll('.mini-ring-fill').forEach(r => { const p = parseFloat(r.dataset.percent) || 0; setTimeout(() => r.style.strokeDashoffset = 157 - (157 * p / 100), 100); }); document.querySelectorAll('[data-counter]').forEach(e => animateCounter(e, parseInt(e.dataset.counter) || 0, 1200)); });
    }
    
    function renderHome() { const s = getCurrentSprint(); if (!s) return '<div class="page-container page-fade"><div class="empty-state"><div class="empty-icon">üöÄ</div><div class="empty-title">–°–æ–∑–¥–∞–π –ø–µ—Ä–≤—ã–π —Å–ø—Ä–∏–Ω—Ç</div><div class="empty-text">12 –Ω–µ–¥–µ–ª—å —Ñ–æ–∫—É—Å–∞ –¥–ª—è —Ü–µ–ª–µ–π</div><button class="btn btn-primary" style="margin-top:24px;padding:18px 40px" onclick="haptic(\'light\'); openNewSprintModal()">–ù–∞—á–∞—Ç—å</button></div></div>'; const exp = isSprintExpired(s), w = getCurrentWeek(), today = getToday(), dow = new Date().getDay(), endDate = new Date(s.endDate), now = new Date(), daysLeft = Math.max(0, Math.ceil((endDate - now) / 86400000)); let todayDone = 0, todayTotal = 0; s.goals.forEach(g => g.tasks.forEach(t => { let shouldDo = t.frequency === 'daily' || (t.frequency === 'workdays' && dow >= 1 && dow <= 5) || (t.frequency === 'weekly' && dow === 1) || (t.frequency === 'twice-week' && (dow === 1 || dow === 4)) || (t.frequency === 'three-week' && (dow === 1 || dow === 3 || dow === 5)); if (shouldDo) { todayTotal++; if (s.completions[t.id + '_' + today]) todayDone++; } })); const overall = s.goals.length > 0 ? Math.round(s.goals.reduce((a, g) => a + getProgress(g), 0) / s.goals.length) : 0, weeklyScore = getWeeklyScore(w.current), trendData = getTrendData(), prevWeekScore = w.current > 1 ? getWeeklyScore(w.current - 1) : 0, scoreDiff = weeklyScore - prevWeekScore; let html = '<div class="page-container">'; if (exp) html += `<div class="sprint-complete-banner stagger-item"><div class="sprint-complete-icon">üèÅ</div><div class="sprint-complete-title">–°–ø—Ä–∏–Ω—Ç –∑–∞–≤–µ—Ä—à—ë–Ω</div><div class="sprint-complete-text">"${escapeHtml(s.name)}" –∑–∞–∫–æ–Ω—á–∏–ª—Å—è. –†–µ–∑—É–ª—å—Ç–∞—Ç: ${overall}%</div><div class="sprint-complete-actions"><button class="btn btn-violet" onclick="haptic('medium'); archiveSprint('${s.id}'); openNewSprintModal()">üì¶ –í –∞—Ä—Ö–∏–≤ + –ù–æ–≤—ã–π</button></div></div>`; html += `<div class="hero-progress stagger-item"><div class="progress-ring-container"><div class="progress-ring-glow"></div><svg class="progress-ring" viewBox="0 0 170 170"><circle class="progress-ring-bg" cx="85" cy="85" r="75"/><circle class="progress-ring-fill" cx="85" cy="85" r="75" data-percent="${overall}"/></svg><div class="progress-ring-text"><div class="progress-ring-value" data-counter="${overall}">0</div><div class="progress-ring-label">–ø—Ä–æ–≥—Ä–µ—Å—Å</div></div></div></div><div class="bento-grid"><div class="bento-card stagger-item" style="--card-gradient:var(--gradient-fire);--value-color:var(--accent)"><div class="bento-icon">üìÖ</div><div class="bento-value">${todayDone}/${todayTotal}</div><div class="bento-label">–°–µ–≥–æ–¥–Ω—è</div></div><div class="bento-card stagger-item" style="--card-gradient:var(--gradient-forest);--value-color:var(--emerald)"><div class="bento-icon">üìä</div><div class="bento-value" data-counter="${weeklyScore}">0</div><div class="bento-label">–ù–µ–¥–µ–ª—è ${w.current}</div></div><div class="bento-card stagger-item" style="--card-gradient:var(--gradient-ocean);--value-color:var(--amber)"><div class="bento-icon">‚è≥</div><div class="bento-value" data-counter="${daysLeft}">0</div><div class="bento-label">–î–Ω–µ–π</div></div><div class="bento-card stagger-item" style="--card-gradient:var(--gradient-fire);--value-color:var(--violet)"><div class="bento-icon">üéØ</div><div class="bento-value">${s.goals.length}</div><div class="bento-label">–¶–µ–ª–µ–π</div></div></div>`; if (s.goals.length > 0 && trendData.length > 0) { html += `<div class="weekly-chart-card stagger-item"><div class="weekly-chart-header"><div><div class="weekly-chart-title">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –Ω–µ–¥–µ–ª—è–º</div><div class="weekly-chart-value" data-counter="${weeklyScore}">0<span style="font-size:20px;color:var(--text-muted)">%</span></div></div>${scoreDiff !== 0 ? `<div class="weekly-chart-change" style="${scoreDiff < 0 ? 'background:var(--rose-dim);color:var(--rose)' : ''}">${scoreDiff > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(scoreDiff)}%</div>` : ''}</div><div class="bar-chart">${trendData.map((v, i) => { const h = Math.max((v / 100) * 100, 8), isLast = i === trendData.length - 1; return `<div class="bar-column" style="animation-delay:${i * 0.1}s"><div class="bar-value">${v}%</div><div class="bar-track"><div class="bar-fill ${isLast ? 'current' : ''}" style="height:${h}%"></div></div><div class="bar-label">W${i + 1}</div></div>`; }).join('')}</div></div>`; } html += `<div class="sprint-info stagger-item"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><div style="font-weight:700;font-size:15px">${escapeHtml(s.name)}</div><span class="status-badge ${exp ? 'expired' : 'active'}"><span class="status-dot"></span>${exp ? '–ó–∞–≤–µ—Ä—à—ë–Ω' : '–ê–∫—Ç–∏–≤–Ω—ã–π'}</span></div><div class="sprint-dates"><div class="sprint-date"><div class="sprint-date-label">–°—Ç–∞—Ä—Ç</div><div class="sprint-date-value">${formatDate(s.startDate)}</div></div><div class="sprint-arrow">‚Üí</div><div class="sprint-date"><div class="sprint-date-label">–§–∏–Ω–∏—à</div><div class="sprint-date-value">${formatDate(s.endDate)}</div></div></div></div><div class="section-header stagger-item"><span class="section-title">–¶–µ–ª–∏ (${s.goals.length}/3)</span></div>`; if (s.goals.length === 0) html += '<div class="empty-state stagger-item"><div class="empty-icon">üéØ</div><div class="empty-title">–°–æ–∑–¥–∞–π –ø–µ—Ä–≤—É—é —Ü–µ–ª—å</div><div class="empty-text">–î–æ 3 —Ü–µ–ª–µ–π –Ω–∞ —Å–ø—Ä–∏–Ω—Ç</div></div>'; else { html += '<div class="goals-list">'; s.goals.forEach((g, i) => { const p = getProgress(g), icon = g.icon || ICONS[i % ICONS.length], gradient = GRADIENTS[i % GRADIENTS.length], accentColor = ACCENT_COLORS[i % ACCENT_COLORS.length]; html += `<div class="goal-card ${gradient} stagger-item" onclick="haptic('light'); openGoal('${g.id}')"><div class="goal-header"><div class="goal-icon">${icon}</div><div class="goal-info"><div class="goal-title">${escapeHtml(g.title)}</div><div class="goal-subtitle">${g.tasks.length} –¥–µ–π—Å—Ç–≤–∏–π</div></div><div class="mini-ring-container"><svg class="mini-ring" viewBox="0 0 58 58"><circle class="mini-ring-bg" cx="29" cy="29" r="25"/><circle class="mini-ring-fill" cx="29" cy="29" r="25" data-percent="${p}" style="stroke:${accentColor}"/></svg><div class="mini-ring-text" style="color:${accentColor}">${p}%</div></div></div><div class="goal-tasks">${g.tasks.slice(0, 3).map(t => '<span class="task-tag">' + escapeHtml(t.name) + '</span>').join('')}${g.tasks.length > 3 ? '<span class="task-tag">+' + (g.tasks.length - 3) + '</span>' : ''}</div></div>`; }); html += '</div>'; } html += '</div>'; return html; }
    
    function renderGoalDetail() { const s = getCurrentSprint(), g = s?.goals.find(x => x.id === selectedGoal); if (!g) return ''; const p = getProgress(g), today = getToday(), dow = new Date().getDay(), icon = g.icon || 'üéØ', exp = isSprintExpired(s), goalIdx = s.goals.findIndex(x => x.id === selectedGoal), accentColor = ACCENT_COLORS[goalIdx % ACCENT_COLORS.length]; const todayTasks = g.tasks.filter(t => t.frequency === 'daily' || (t.frequency === 'workdays' && dow >= 1 && dow <= 5) || (t.frequency === 'weekly' && dow === 1) || (t.frequency === 'twice-week' && (dow === 1 || dow === 4)) || (t.frequency === 'three-week' && (dow === 1 || dow === 3 || dow === 5))); let totalTasks = 0, totalDone = 0; g.tasks.forEach(t => { totalTasks += getTaskTotal(t.frequency); totalDone += getTaskDone(t.id); }); let html = `<div class="page-container"><div class="detail-header"><button class="back-btn" onclick="haptic('light'); closeGoal()"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>–ù–∞–∑–∞–¥</button><div class="detail-title">${icon} ${escapeHtml(g.title)}</div><div class="progress-ring-container" style="margin-bottom:20px"><div class="progress-ring-glow"></div><svg class="progress-ring" viewBox="0 0 170 170"><circle class="progress-ring-bg" cx="85" cy="85" r="75"/><circle class="progress-ring-fill" cx="85" cy="85" r="75" data-percent="${p}" style="stroke:${accentColor}"/></svg><div class="progress-ring-text"><div class="progress-ring-value" data-counter="${p}">0</div><div class="progress-ring-label">–≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div></div></div><div class="detail-stats"><div class="detail-stat stagger-item"><div class="detail-stat-value text-emerald" data-counter="${totalDone}">0</div><div class="detail-stat-label">–°–¥–µ–ª–∞–Ω–æ</div></div><div class="detail-stat stagger-item"><div class="detail-stat-value text-accent" data-counter="${totalTasks}">0</div><div class="detail-stat-label">–í—Å–µ–≥–æ</div></div><div class="detail-stat stagger-item"><div class="detail-stat-value text-amber" data-counter="${totalTasks - totalDone}">0</div><div class="detail-stat-label">–û—Å—Ç–∞–ª–æ—Å—å</div></div></div>`; if (!exp) html += `<div class="detail-actions"><button class="action-btn stagger-item" onclick="haptic('light'); editGoal('${g.id}')"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>–ò–∑–º–µ–Ω–∏—Ç—å</button><button class="action-btn danger stagger-item" onclick="deleteGoal('${g.id}', event)"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>–£–¥–∞–ª–∏—Ç—å</button></div>`; html += '</div><div class="task-section">'; if (!exp) { html += '<div class="section-header"><span class="section-title">–ù–∞ —Å–µ–≥–æ–¥–Ω—è</span></div>'; if (todayTasks.length === 0) html += '<div style="text-align:center;padding:30px;color:var(--text-muted)">–ù–µ—Ç –∑–∞–¥–∞—á –Ω–∞ —Å–µ–≥–æ–¥–Ω—è üéâ</div>'; else todayTasks.forEach((t, i) => { const isDone = s.completions[t.id + '_' + today]; html += `<div class="task-item stagger-item ${isDone ? 'completed' : ''}" style="animation-delay:${i * 0.05}s"><button class="task-checkbox ${isDone ? 'checked' : ''}" onclick="event.stopPropagation(); toggleTask('${t.id}', '${today}', true)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></button><div class="task-info"><div class="task-name">${escapeHtml(t.name)}</div><div class="task-freq">${FREQ[t.frequency]?.label || ''}</div></div></div>`; }); } html += '<div class="section-header" style="margin-top:24px"><span class="section-title">–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è</span></div>'; g.tasks.forEach((t, i) => { const done = getTaskDone(t.id); html += `<div class="task-item stagger-item" style="animation-delay:${i * 0.05}s" onclick="haptic('light'); openTaskTracker('${g.id}', '${t.id}')"><div class="task-info"><div class="task-name">${escapeHtml(t.name)}</div><div class="task-freq">${FREQ[t.frequency]?.label || ''}</div></div><div class="task-streak">üî• ${done}</div></div>`; }); html += '</div></div>'; return html; }
    function renderTaskTracker() { const s = getCurrentSprint(), g = s?.goals.find(x => x.id === selectedTask.goalId), t = g?.tasks.find(x => x.id === selectedTask.taskId); if (!g || !t) return ''; const total = getTaskTotal(t.frequency), done = getTaskDone(t.id), sprintDays = getSprintDays(), startDate = new Date(s.startDate), dates = [], today = getToday(), progress = total > 0 ? Math.round(done / total * 100) : 0; for (let i = 0; i < sprintDays; i++) { const d = new Date(startDate); d.setDate(startDate.getDate() + i); dates.push(d.toISOString().split('T')[0]); } let html = `<div class="page-container"><div class="detail-header"><button class="back-btn" onclick="haptic('light'); closeTaskTracker()"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>–ù–∞–∑–∞–¥</button><div class="detail-title">${escapeHtml(t.name)}</div><div style="color:var(--text-muted);font-size:14px;margin-bottom:20px;position:relative;z-index:1">${escapeHtml(g.title)}</div><div class="progress-ring-container" style="margin-bottom:20px"><div class="progress-ring-glow"></div><svg class="progress-ring" viewBox="0 0 170 170"><circle class="progress-ring-bg" cx="85" cy="85" r="75"/><circle class="progress-ring-fill" cx="85" cy="85" r="75" data-percent="${progress}"/></svg><div class="progress-ring-text"><div class="progress-ring-value" data-counter="${progress}">0</div><div class="progress-ring-label">–≥–æ—Ç–æ–≤–æ</div></div></div><div class="detail-stats"><div class="detail-stat stagger-item"><div class="detail-stat-value text-emerald" data-counter="${done}">0</div><div class="detail-stat-label">–°–¥–µ–ª–∞–Ω–æ</div></div><div class="detail-stat stagger-item"><div class="detail-stat-value text-accent" data-counter="${total}">0</div><div class="detail-stat-label">–í—Å–µ–≥–æ</div></div><div class="detail-stat stagger-item"><div class="detail-stat-value text-amber" data-counter="${total - done}">0</div><div class="detail-stat-label">–û—Å—Ç–∞–ª–æ—Å—å</div></div></div></div><div class="task-section"><div class="section-header"><span class="section-title">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å</span></div><div class="analytics-card"><div class="tracker-grid">`; for (let i = 0; i < total; i++) { const isDone = i < done; html += `<div class="tracker-cell ${isDone ? 'done' : ''}" style="animation-delay:${i * 0.02}s"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div>`; } html += `</div></div><div class="section-header" style="margin-top:24px"><span class="section-title">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></div><div class="analytics-card"><div class="heatmap">`; dates.forEach((d, i) => { const isDone = s.completions[t.id + '_' + d], isPast = d < today; html += `<div class="heatmap-cell ${isDone ? 'done' : (isPast ? 'missed' : '')}" onclick="toggleTask('${t.id}', '${d}')" title="${formatDate(d)}" style="animation-delay:${i * 0.01}s"></div>`; }); html += '</div><div class="heatmap-legend"><span>–ü—Ä–æ–ø—É—Å–∫</span><div class="heatmap-legend-item" style="background:var(--rose-dim)"></div><div class="heatmap-legend-item" style="background:var(--emerald)"></div><span>–°–¥–µ–ª–∞–Ω–æ</span></div></div></div></div>'; return html; }
    
    function renderAnalytics() { const s = getCurrentSprint(); if (!s?.goals?.length) return '<div class="page-container page-fade"><div class="empty-state"><div class="empty-icon">üìä</div><div class="empty-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div><div class="empty-text">–°–æ–∑–¥–∞–π —Ü–µ–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</div></div></div>'; const trendData = getTrendData(); let html = `<div class="page-container"><div class="section-header stagger-item"><span class="section-title">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –Ω–µ–¥–µ–ª—è–º</span></div><div class="weekly-chart-card stagger-item"><div class="bar-chart">${trendData.map((v, i) => { const h = Math.max((v / 100) * 100, 8), isLast = i === trendData.length - 1; return `<div class="bar-column" style="animation-delay:${i * 0.1}s"><div class="bar-value">${v}%</div><div class="bar-track"><div class="bar-fill ${isLast ? 'current' : ''}" style="height:${h}%"></div></div><div class="bar-label">W${i + 1}</div></div>`; }).join('')}</div></div><div class="section-header stagger-item" style="margin-top:24px"><span class="section-title">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ü–µ–ª—è–º</span></div>`; s.goals.forEach((g, idx) => { const p = getProgress(g), icon = g.icon || ICONS[idx % ICONS.length], accentColor = ACCENT_COLORS[idx % ACCENT_COLORS.length]; html += `<div class="analytics-card stagger-item"><div class="analytics-title" style="position:relative;z-index:1"><span>${icon}</span>${escapeHtml(g.title)}</div><div style="width:100px;height:100px;margin:0 auto 16px;position:relative"><svg viewBox="0 0 100 100" style="width:100px;height:100px;transform:rotate(-90deg)"><circle cx="50" cy="50" r="42" fill="none" stroke="var(--bg-primary)" stroke-width="8"/><circle cx="50" cy="50" r="42" fill="none" stroke="${accentColor}" stroke-width="8" stroke-linecap="round" stroke-dasharray="264" stroke-dashoffset="${264 - (264 * p / 100)}" style="transition:stroke-dashoffset 1s var(--ease-out);filter:drop-shadow(0 0 10px ${accentColor})"/></svg><div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center"><div style="font-size:28px;font-weight:800" data-counter="${p}">0</div><div style="font-size:9px;font-weight:600;color:var(--text-muted);text-transform:uppercase">%</div></div></div>`; g.tasks.forEach(t => { const total = getTaskTotal(t.frequency), done = getTaskDone(t.id), tp = total > 0 ? Math.round(done / total * 100) : 0; html += `<div class="task-item" onclick="haptic('light'); openTaskTracker('${g.id}', '${t.id}')" style="margin-bottom:8px;position:relative;z-index:1"><div class="task-info"><div class="task-name">${escapeHtml(t.name)}</div><div class="task-freq">${done} –∏–∑ ${total} ‚Ä¢ ${tp}%</div></div><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="var(--text-muted)" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></div>`; }); html += '</div>'; }); html += '</div>'; return html; }
    
    function renderArchive() { let html = '<div class="page-container"><div class="section-header stagger-item"><span class="section-title">üì¶ –ê—Ä—Ö–∏–≤</span></div>'; if (state.archivedSprints.length === 0) html += '<div class="empty-state stagger-item"><div class="empty-icon" style="background:var(--violet-dim)">üì¶</div><div class="empty-title">–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç</div><div class="empty-text">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Å–ø—Ä–∏–Ω—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å</div></div>'; else { state.archivedSprints.forEach((s, i) => { const score = s.finalScore || calculateSprintScore(s), comp = s.totalTasksCompleted || countCompletedTasks(s), goalsCount = s.goals?.length || 0; html += `<div class="archive-card stagger-item" style="animation-delay:${i * 0.1}s" onclick="haptic('light'); openArchiveDetail('${s.id}')"><div class="archive-header"><div><div class="archive-name">${escapeHtml(s.name)}</div><div class="archive-dates">${formatDate(s.startDate)} ‚Äî ${formatDate(s.endDate)}</div></div><div class="archive-score">${score}%</div></div><div class="archive-stats"><div class="archive-stat"><div class="archive-stat-value">${goalsCount}</div><div class="archive-stat-label">–¶–µ–ª–µ–π</div></div><div class="archive-stat"><div class="archive-stat-value">${comp}</div><div class="archive-stat-label">–ó–∞–¥–∞—á</div></div><div class="archive-stat"><div class="archive-stat-value">${s.reviews?.length || 0}</div><div class="archive-stat-label">–û—Ç—á—ë—Ç–æ–≤</div></div></div></div>`; }); } html += '</div>'; return html; }
    
    function renderArchiveDetail() { const s = state.archivedSprints.find(x => x.id === selectedArchive); if (!s) return ''; const score = s.finalScore || calculateSprintScore(s), comp = s.totalTasksCompleted || countCompletedTasks(s), sprintDays = getSprintDays(s); let html = `<div class="page-container"><button class="back-btn" style="padding:20px 20px 0" onclick="haptic('light'); closeArchiveDetail()"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>–ê—Ä—Ö–∏–≤</button><div style="text-align:center;padding:30px 20px;background:linear-gradient(180deg, var(--violet-dim) 0%, transparent 100%);margin-bottom:20px"><div style="display:inline-block;padding:8px 18px;background:var(--violet-dim);border:1px solid var(--violet);border-radius:var(--radius-full);font-size:11px;font-weight:600;color:var(--violet);text-transform:uppercase;margin-bottom:16px">–ê—Ä—Ö–∏–≤</div><div style="font-size:28px;font-weight:800;margin-bottom:8px">${escapeHtml(s.name)}</div><div style="font-size:14px;color:var(--text-muted)">${formatDateFull(s.startDate)} ‚Äî ${formatDateFull(s.endDate)}</div></div><div style="padding:0 20px"><div class="progress-ring-container stagger-item"><div class="progress-ring-glow" style="background:radial-gradient(circle, rgba(139, 92, 246, 0.4) 0%, transparent 70%)"></div><svg class="progress-ring" viewBox="0 0 170 170"><circle class="progress-ring-bg" cx="85" cy="85" r="75"/><circle class="progress-ring-fill" cx="85" cy="85" r="75" data-percent="${score}" style="stroke:url(#violetGradient)"/></svg><div class="progress-ring-text"><div class="progress-ring-value" style="color:var(--violet)" data-counter="${score}">0</div><div class="progress-ring-label">—Ñ–∏–Ω–∞–ª</div></div></div><div class="bento-grid"><div class="bento-card stagger-item" style="--value-color:var(--emerald)"><div class="bento-value" data-counter="${comp}">0</div><div class="bento-label">–ó–∞–¥–∞—á</div></div><div class="bento-card stagger-item" style="--value-color:var(--violet)"><div class="bento-value" data-counter="${sprintDays}">0</div><div class="bento-label">–î–Ω–µ–π</div></div></div><div class="section-header stagger-item" style="margin-top:24px"><span class="section-title">–¶–µ–ª–∏ —Å–ø—Ä–∏–Ω—Ç–∞</span></div>`; if (s.goals?.length > 0) s.goals.forEach((g, idx) => { const icon = g.icon || ICONS[idx % ICONS.length], gradient = GRADIENTS[idx % GRADIENTS.length]; let gDone = 0, gTotal = 0; g.tasks.forEach(t => { const f = FREQ[t.frequency]; if (f) { gTotal += Math.round(f.total * sprintDays / 84); Object.keys(s.completions || {}).forEach(k => { if (k.startsWith(t.id + '_') && s.completions[k]) gDone++; }); } }); const gp = gTotal > 0 ? Math.round(gDone / gTotal * 100) : 0; html += `<div class="goal-card ${gradient} stagger-item" style="cursor:default"><div class="goal-header"><div class="goal-icon">${icon}</div><div class="goal-info"><div class="goal-title">${escapeHtml(g.title)}</div><div class="goal-subtitle">${g.tasks.length} –¥–µ–π—Å—Ç–≤–∏–π ‚Ä¢ ${gDone}/${gTotal}</div></div><div class="mini-ring-container"><svg class="mini-ring" viewBox="0 0 58 58"><circle class="mini-ring-bg" cx="29" cy="29" r="25"/><circle class="mini-ring-fill" cx="29" cy="29" r="25" data-percent="${gp}" style="stroke:var(--violet)"/></svg><div class="mini-ring-text" style="color:var(--violet)">${gp}%</div></div></div></div>`; }); else html += '<div style="text-align:center;padding:30px;color:var(--text-muted)">–ù–µ—Ç —Ü–µ–ª–µ–π</div>'; html += `<div style="margin-top:32px" class="stagger-item"><button class="btn btn-danger" style="width:100%" onclick="haptic('medium'); deleteFromArchive('${s.id}')">–£–¥–∞–ª–∏—Ç—å</button></div></div></div>`; return html; }
    
    function renderReview() { const s = getCurrentSprint(); if (!s) return '<div class="page-container page-fade"><div class="empty-state"><div class="empty-icon">üìù</div><div class="empty-title">–ù–µ—Ç —Å–ø—Ä–∏–Ω—Ç–∞</div><div class="empty-text">–°–æ–∑–¥–∞–π —Å–ø—Ä–∏–Ω—Ç</div></div></div>'; const w = getCurrentWeek(), currentReview = s.reviews?.find(r => r.week === w.current), weeklyScore = getWeeklyScore(w.current), overall = s.goals.length > 0 ? Math.round(s.goals.reduce((a, g) => a + getProgress(g), 0) / s.goals.length) : 0; let html = `<div class="page-container"><div class="section-header stagger-item"><span class="section-title">–†–µ—Ñ–ª–µ–∫—Å–∏—è</span></div><div class="analytics-card stagger-item"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><div><div style="font-size:20px;font-weight:700;margin-bottom:4px">–ù–µ–¥–µ–ª—è ${w.current}</div><div style="font-size:13px;color:var(--text-muted)">${currentReview ? '‚úì –ó–∞–ø–æ–ª–Ω–µ–Ω' : '–ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω'}</div></div><button class="btn btn-primary" style="flex:none;padding:12px 20px" onclick="haptic('light'); openReviewModal()">${currentReview ? '–ò–∑–º–µ–Ω–∏—Ç—å' : '–ó–∞–ø–æ–ª–Ω–∏—Ç—å'}</button></div><div class="detail-stats"><div class="detail-stat"><div class="detail-stat-value text-accent" data-counter="${weeklyScore}">0</div><div class="detail-stat-label">Weekly</div></div><div class="detail-stat"><div class="detail-stat-value text-emerald" data-counter="${overall}">0</div><div class="detail-stat-label">–û–±—â–∏–π</div></div><div class="detail-stat"><div class="detail-stat-value text-amber">${s.reviews?.length || 0}</div><div class="detail-stat-label">–û—Ç—á—ë—Ç–æ–≤</div></div></div></div><div class="section-header stagger-item" style="margin-top:24px"><span class="section-title">–ò—Å—Ç–æ—Ä–∏—è</span></div>`; if (!s.reviews?.length) html += '<div style="text-align:center;padding:40px;color:var(--text-muted)" class="stagger-item">–ù–µ—Ç –æ—Ç—á—ë—Ç–æ–≤</div>'; else [...s.reviews].sort((a, b) => b.week - a.week).forEach((r, i) => { html += `<div class="review-card stagger-item" style="animation-delay:${i * 0.05}s"><div class="review-header"><span class="review-week">üìÖ –ù–µ–¥–µ–ª—è ${r.week}</span><span class="review-score">${r.score}%</span></div>${r.energy ? '<div class="review-section"><div class="review-question">‚ö° –°–ª–∏–≤ —ç–Ω–µ—Ä–≥–∏–∏</div><div class="review-answer">' + escapeHtml(r.energy) + '</div></div>' : ''}${r.blocker ? '<div class="review-section"><div class="review-question">üöß –ë–ª–æ–∫–µ—Ä</div><div class="review-answer">' + escapeHtml(r.blocker) + '</div></div>' : ''}${r.growth ? '<div class="review-section"><div class="review-question">üéØ –¢–æ—á–∫–∏ —Ä–æ—Å—Ç–∞</div><div class="review-answer">' + escapeHtml(r.growth) + '</div></div>' : ''}${r.wins ? '<div class="review-section"><div class="review-question">üèÜ –ü–æ–±–µ–¥—ã</div><div class="review-answer">' + escapeHtml(r.wins) + '</div></div>' : ''}</div>`; }); html += '</div>'; return html; }
    
    function renderSettings() { const s = getCurrentSprint(), soundOn = state.settings?.soundEnabled !== false, vibrationOn = state.settings?.vibrationEnabled !== false; return `<div class="page-container"><div class="sprint-selector stagger-item"><div class="sprint-selector-header"><span class="sprint-selector-title">–°–ø—Ä–∏–Ω—Ç—ã</span><button class="btn btn-primary" style="padding:10px 16px;font-size:12px" onclick="haptic('light'); SoundFX.tap(); openNewSprintModal()">+ –ù–æ–≤—ã–π</button></div>${state.sprints.length === 0 ? '<div style="text-align:center;padding:20px;color:var(--text-muted)">–ù–µ—Ç —Å–ø—Ä–∏–Ω—Ç–æ–≤</div>' : '<div class="sprint-list">' + state.sprints.map(sp => { const exp = isSprintExpired(sp); return `<div class="sprint-item ${sp.id === state.currentSprintId ? 'active' : ''}" onclick="haptic('light'); SoundFX.tap(); switchSprint('${sp.id}')"><div><div class="sprint-item-name">${escapeHtml(sp.name)}</div><div class="sprint-item-dates">${formatDate(sp.startDate)} ‚Äî ${formatDate(sp.endDate)}</div></div><div style="display:flex;align-items:center;gap:8px">${exp ? '<span class="status-badge expired"><span class="status-dot"></span>–ó–∞–≤–µ—Ä—à—ë–Ω</span>' : ''}${sp.id === state.currentSprintId ? '<span style="color:var(--accent)">‚úì</span>' : ''}</div></div>`; }).join('') + '</div>'}</div><div class="section-header stagger-item"><span class="section-title">üîä –ó–≤—É–∫ –∏ –≤–∏–±—Ä–∞—Ü–∏—è</span></div><div class="settings-item stagger-item" onclick="toggleSetting('soundEnabled')"><div class="settings-icon" style="${soundOn ? '' : 'background:var(--bg-elevated);color:var(--text-muted)'}"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">${soundOn ? '<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>' : '<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/>'}</svg></div><div class="settings-content"><div class="settings-label">–ó–≤—É–∫–∏</div><div class="settings-desc">${soundOn ? '–í–∫–ª—é—á–µ–Ω—ã' : '–í—ã–∫–ª—é—á–µ–Ω—ã'}</div></div><div class="toggle-switch ${soundOn ? 'active' : ''}"><div class="toggle-knob"></div></div></div><div class="settings-item stagger-item" onclick="toggleSetting('vibrationEnabled')"><div class="settings-icon" style="${vibrationOn ? '' : 'background:var(--bg-elevated);color:var(--text-muted)'}"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"/>${vibrationOn ? '<path d="M1 9h2m18 0h2M1 15h2m18 0h2"/>' : ''}</svg></div><div class="settings-content"><div class="settings-label">–í–∏–±—Ä–∞—Ü–∏—è</div><div class="settings-desc">${vibrationOn ? '–í–∫–ª—é—á–µ–Ω–∞' : '–í—ã–∫–ª—é—á–µ–Ω–∞'}</div></div><div class="toggle-switch ${vibrationOn ? 'active' : ''}"><div class="toggle-knob"></div></div></div>${s ? `<div class="section-header stagger-item" style="margin-top:24px"><span class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ø—Ä–∏–Ω—Ç–∞</span></div><div class="form-row stagger-item" style="margin-bottom:20px"><div class="form-group" style="margin-bottom:0"><label class="form-label">–°—Ç–∞—Ä—Ç</label><input type="date" class="form-input" value="${s.startDate}" onchange="updateSprintDate('start', this.value)"></div><div class="form-group" style="margin-bottom:0"><label class="form-label">–§–∏–Ω–∏—à</label><input type="date" class="form-input" value="${s.endDate}" onchange="updateSprintDate('end', this.value)"></div></div><div class="sprint-info stagger-item" style="margin-top:8px"><div style="text-align:center"><div style="font-size:42px;font-weight:800;color:var(--accent)" data-counter="${getSprintDays()}">0</div><div style="font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px">–î–Ω–µ–π</div></div></div>${!isSprintExpired(s) ? `<div class="settings-item stagger-item" onclick="haptic('medium'); confirmArchiveSprint()"><div class="settings-icon violet"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 8v13H3V8"/><path d="M1 3h22v5H1z"/></svg></div><div class="settings-content"><div class="settings-label">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–ø—Ä–∏–Ω—Ç</div><div class="settings-desc">–í –∞—Ä—Ö–∏–≤ –¥–æ—Å—Ä–æ—á–Ω–æ</div></div><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="var(--text-muted)" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></div>` : ''}` : ''}<div class="section-header stagger-item" style="margin-top:28px"><span class="section-title">–î–∞–Ω–Ω—ã–µ</span></div><div class="settings-item stagger-item" onclick="haptic('light'); exportData()"><div class="settings-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></div><div class="settings-content"><div class="settings-label">–≠–∫—Å–ø–æ—Ä—Ç</div><div class="settings-desc">–°–∫–∞—á–∞—Ç—å JSON</div></div><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="var(--text-muted)" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></div><div class="settings-item stagger-item" onclick="haptic('light'); importData()"><div class="settings-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></div><div class="settings-content"><div class="settings-label">–ò–º–ø–æ—Ä—Ç</div><div class="settings-desc">–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</div></div><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="var(--text-muted)" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></div><div style="margin-top:50px;text-align:center;color:var(--text-muted)" class="stagger-item"><div style="font-size:18px;font-weight:800;background:linear-gradient(135deg,var(--accent) 0%,var(--amber) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px">HUSTLE YEAR</div><div style="font-size:12px">v10 PWA ‚Ä¢ Offline Ready</div><div style="font-size:11px;margin-top:4px">üì¶ ${state.archivedSprints.length} —Å–ø—Ä–∏–Ω—Ç–æ–≤ –≤ –∞—Ä—Ö–∏–≤–µ</div></div></div>`; }
    // ==================== ACTIONS ====================
    function switchTab(tab) { haptic('light'); SoundFX.tap(); if (currentTab !== tab) { currentTab = tab; selectedGoal = null; selectedTask = null; selectedArchive = null; render(); } }
    function switchSprint(id) { state.currentSprintId = id; saveState(); render(); showToast('–°–ø—Ä–∏–Ω—Ç –≤—ã–±—Ä–∞–Ω ‚úì'); }
    function openGoal(id) { selectedGoal = id; render(); }
    function closeGoal() { selectedGoal = null; render(); }
    function openTaskTracker(goalId, taskId) { selectedTask = { goalId, taskId }; render(); }
    function closeTaskTracker() { selectedTask = null; render(); }
    function openArchiveDetail(id) { selectedArchive = id; render(); }
    function closeArchiveDetail() { selectedArchive = null; render(); }
    function deleteFromArchive(id) { if (!confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑ –∞—Ä—Ö–∏–≤–∞?')) return; state.archivedSprints = state.archivedSprints.filter(s => s.id !== id); saveState(); selectedArchive = null; render(); showToast('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∞—Ä—Ö–∏–≤–∞', 'success'); }
    
    function toggleTask(taskId, date, showEffects = false) {
        const s = getCurrentSprint(); if (!s || isSprintExpired(s)) return;
        const key = taskId + '_' + date; s.completions[key] = !s.completions[key];
        if (s.completions[key] && showEffects) { haptic('success'); SoundFX.taskComplete(); showSuccessRing(); setTimeout(checkDayCompletion, 300); }
        saveState(); render();
    }
    
    function toggleSetting(key) { haptic('light'); SoundFX.tap(); if (!state.settings) state.settings = {}; state.settings[key] = !state.settings[key]; saveState(); render(); }
    function updateSprintDate(type, value) { const s = getCurrentSprint(); if (!s) return; if (type === 'start') s.startDate = value; else s.endDate = value; saveState(); render(); showToast('–î–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã ‚úì'); }
    function confirmArchiveSprint() { if (confirm('–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å?')) { const s = getCurrentSprint(); if (s) { archiveSprint(s.id); render(); } } }
    
    // Modals
    function openCreateModal() { haptic('light'); SoundFX.tap(); editingGoalId = null; selectedIcon = 'üéØ'; document.getElementById('modalTitle').textContent = '–ù–æ–≤–∞—è —Ü–µ–ª—å'; document.getElementById('goalTitle').value = ''; document.getElementById('iconPicker').innerHTML = ICONS.map(i => `<div class="icon-option ${i === selectedIcon ? 'selected' : ''}" onclick="selectIcon('${i}')">${i}</div>`).join(''); document.getElementById('tasksList').innerHTML = ''; addTaskField(); document.getElementById('createModal').classList.add('show'); }
    function closeCreateModal() { haptic('light'); document.getElementById('createModal').classList.remove('show'); }
    function selectIcon(icon) { haptic('light'); selectedIcon = icon; document.querySelectorAll('.icon-option').forEach(e => e.classList.toggle('selected', e.textContent === icon)); }
    function addTaskField() { haptic('light'); const list = document.getElementById('tasksList'), idx = list.children.length; list.insertAdjacentHTML('beforeend', `<div class="task-row" style="animation-delay:${idx * 0.05}s"><input type="text" class="form-input task-name-input" placeholder="–ß—Ç–æ –¥–µ–ª–∞—Ç—å?"><select class="form-input task-freq-select"><option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option><option value="workdays">–ü–æ –±—É–¥–Ω—è–º</option><option value="weekly">1√ó/–Ω–µ–¥–µ–ª—é</option><option value="twice-week">2√ó/–Ω–µ–¥–µ–ª—é</option><option value="three-week">3√ó/–Ω–µ–¥–µ–ª—é</option></select><button class="icon-btn danger" onclick="this.parentElement.remove()"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>`); }
    function saveGoal() {
        haptic('medium'); const s = getCurrentSprint(); if (!s) return;
        const title = document.getElementById('goalTitle').value.trim(); if (!title) { showToast('–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ!'); return; }
        const tasks = []; document.querySelectorAll('.task-row').forEach(row => { const name = row.querySelector('.task-name-input')?.value.trim(), freq = row.querySelector('.task-freq-select')?.value; if (name) tasks.push({ id: genId(), name, frequency: freq || 'daily' }); });
        if (tasks.length === 0) { showToast('–î–æ–±–∞–≤—å –¥–µ–π—Å—Ç–≤–∏–µ!'); return; }
        if (editingGoalId) { const g = s.goals.find(x => x.id === editingGoalId); if (g) { g.title = title; g.icon = selectedIcon; g.tasks = tasks; } }
        else { if (s.goals.length >= 3) { showToast('–ú–∞–∫—Å–∏–º—É–º 3 —Ü–µ–ª–∏!'); return; } s.goals.push({ id: genId(), title, icon: selectedIcon, tasks }); }
        saveState(); closeCreateModal(); SoundFX.celebration(); showConfetti(); showToast(editingGoalId ? '–¶–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞! ‚ú®' : '–¶–µ–ª—å —Å–æ–∑–¥–∞–Ω–∞! üéØ', 'success'); render();
    }
    function editGoal(id) { const s = getCurrentSprint(), g = s?.goals.find(x => x.id === id); if (!g) return; haptic('light'); editingGoalId = id; selectedIcon = g.icon || 'üéØ'; document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'; document.getElementById('goalTitle').value = g.title; document.getElementById('iconPicker').innerHTML = ICONS.map(i => `<div class="icon-option ${i === selectedIcon ? 'selected' : ''}" onclick="selectIcon('${i}')">${i}</div>`).join(''); document.getElementById('tasksList').innerHTML = g.tasks.map((t, i) => `<div class="task-row" style="animation-delay:${i * 0.05}s"><input type="text" class="form-input task-name-input" value="${escapeHtml(t.name)}"><select class="form-input task-freq-select">${Object.entries(FREQ).map(([k, v]) => `<option value="${k}" ${t.frequency === k ? 'selected' : ''}>${v.label}</option>`).join('')}</select><button class="icon-btn danger" onclick="this.parentElement.remove()"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>`).join(''); document.getElementById('createModal').classList.add('show'); }
    function deleteGoal(id, e) { e?.stopPropagation(); if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å?')) return; haptic('medium'); const s = getCurrentSprint(); if (s) { s.goals = s.goals.filter(g => g.id !== id); saveState(); selectedGoal = null; render(); showToast('–¶–µ–ª—å —É–¥–∞–ª–µ–Ω–∞'); } }
    
    function openNewSprintModal() { haptic('light'); const today = new Date(), end = new Date(today); end.setDate(today.getDate() + 84); document.getElementById('newSprintName').value = `–°–ø—Ä–∏–Ω—Ç ${state.sprints.length + state.archivedSprints.length + 1}`; document.getElementById('newSprintStart').value = today.toISOString().split('T')[0]; document.getElementById('newSprintEnd').value = end.toISOString().split('T')[0]; updateNewSprintDays(); document.getElementById('newSprintModal').classList.add('show'); }
    function closeNewSprintModal() { haptic('light'); document.getElementById('newSprintModal').classList.remove('show'); }
    function updateNewSprintDays() { const start = document.getElementById('newSprintStart').value, end = document.getElementById('newSprintEnd').value; if (start && end) { const days = Math.ceil((new Date(end) - new Date(start)) / 86400000); document.getElementById('newSprintDays').textContent = days; } }
    function createNewSprintFromModal() { haptic('medium'); const name = document.getElementById('newSprintName').value.trim() || `–°–ø—Ä–∏–Ω—Ç ${state.sprints.length + state.archivedSprints.length + 1}`, start = document.getElementById('newSprintStart').value, end = document.getElementById('newSprintEnd').value; if (!start || !end) { showToast('–í—ã–±–µ—Ä–∏ –¥–∞—Ç—ã!'); return; } createNewSprint(name, start, end); closeNewSprintModal(); SoundFX.celebration(); showConfetti(); showToast('–°–ø—Ä–∏–Ω—Ç —Å–æ–∑–¥–∞–Ω! üöÄ', 'success'); render(); }
    
    function openReviewModal() { haptic('light'); const s = getCurrentSprint(), w = getCurrentWeek(), r = s?.reviews?.find(x => x.week === w.current); document.getElementById('reviewWeekNum').textContent = w.current; document.getElementById('reviewScore').value = r?.score || getWeeklyScore(w.current); document.getElementById('reviewEnergy').value = r?.energy || ''; document.getElementById('reviewBlocker').value = r?.blocker || ''; document.getElementById('reviewGrowth').value = r?.growth || ''; document.getElementById('reviewWins').value = r?.wins || ''; document.getElementById('reviewModal').classList.add('show'); }
    function closeReviewModal() { haptic('light'); document.getElementById('reviewModal').classList.remove('show'); }
    function saveReview() { haptic('medium'); const s = getCurrentSprint(); if (!s) return; const w = getCurrentWeek(), review = { week: w.current, score: parseInt(document.getElementById('reviewScore').value) || 0, energy: document.getElementById('reviewEnergy').value.trim(), blocker: document.getElementById('reviewBlocker').value.trim(), growth: document.getElementById('reviewGrowth').value.trim(), wins: document.getElementById('reviewWins').value.trim(), date: getToday() }; if (!s.reviews) s.reviews = []; const idx = s.reviews.findIndex(r => r.week === w.current); if (idx >= 0) s.reviews[idx] = review; else s.reviews.push(review); saveState(); closeReviewModal(); SoundFX.celebration(); showToast('–û—Ç—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω! üìù', 'success'); render(); }
    
    function exportData() { const data = JSON.stringify(state, null, 2), blob = new Blob([data], { type: 'application/json' }), url = URL.createObjectURL(blob), a = document.createElement('a'); a.href = url; a.download = `hustle-year-${getToday()}.json`; a.click(); URL.revokeObjectURL(url); showToast('–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ! üì¶', 'success'); }
    function importData() { const input = document.createElement('input'); input.type = 'file'; input.accept = '.json'; input.onchange = e => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = ev => { try { const data = JSON.parse(ev.target.result); if (data.sprints || data.archivedSprints) { state = { ...state, ...data }; saveState(); render(); showToast('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ! ‚ú®', 'success'); } else showToast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç'); } catch(err) { showToast('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è'); } }; reader.readAsText(file); }; input.click(); }
    
    // Pull to refresh
    let pullStartY = 0, pulling = false;
    document.addEventListener('touchstart', e => { if (window.scrollY === 0 && currentTab === 'home' && !selectedGoal && !selectedTask) { pullStartY = e.touches[0].clientY; pulling = true; } }, { passive: true });
    document.addEventListener('touchmove', e => { if (!pulling) return; const diff = e.touches[0].clientY - pullStartY; document.getElementById('pullIndicator')?.classList.toggle('show', diff > 60); }, { passive: true });
    document.addEventListener('touchend', () => { if (document.getElementById('pullIndicator')?.classList.contains('show')) { haptic('medium'); render(); showToast('–û–±–Ω–æ–≤–ª–µ–Ω–æ! ‚ú®'); } document.getElementById('pullIndicator')?.classList.remove('show'); pulling = false; });
    
    // Audio init on interaction
    document.addEventListener('click', () => { if (!audioCtx) initAudio(); }, { once: true });
    document.addEventListener('touchstart', () => { if (!audioCtx) initAudio(); }, { once: true });
    
    // Modal drag to close
    document.querySelectorAll('.modal-handle').forEach(handle => { let startY = 0, currentY = 0; handle.addEventListener('touchstart', e => { startY = e.touches[0].clientY; }); handle.addEventListener('touchmove', e => { currentY = e.touches[0].clientY; const diff = currentY - startY, modal = handle.closest('.modal'); if (diff > 0) modal.style.transform = `translateY(${diff}px)`; }); handle.addEventListener('touchend', () => { const modal = handle.closest('.modal'), overlay = modal.closest('.modal-overlay'); if (currentY - startY > 100) overlay.classList.remove('show'); modal.style.transform = ''; }); });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeCreateModal(); closeNewSprintModal(); closeReviewModal(); closeCelebration(); closeSprintComplete(); if (selectedGoal) closeGoal(); if (selectedTask) closeTaskTracker(); if (selectedArchive) closeArchiveDetail(); } });
    
    // Init
    loadState();
    </script>
</body>
</html>
